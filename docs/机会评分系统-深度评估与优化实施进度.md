# æœºä¼šè¯„åˆ†ç³»ç»Ÿ - æ·±åº¦è¯„ä¼°ä¸ä¼˜åŒ–å®æ–½è¿›åº¦

> **å¼€å§‹æ—¶é—´**: 2025-11-19  
> **å®Œæˆæ—¶é—´**: 2025-11-19  
> **å½“å‰çŠ¶æ€**: âœ… é˜¶æ®µä¸€ã€äºŒå·²å®Œæˆå¹¶éªŒè¯  
> **å®æ–½ç‰ˆæœ¬**: v1.1 (ç­–ç•¥è‡ªé€‚åº” + åŠ¨æ€æµåŠ¨æ€§è¯„åˆ†ç³»ç»Ÿ)

---

## âœ… é˜¶æ®µä¸€ï¼šæ ¸å¿ƒä¼˜åŒ–ï¼ˆå·²å®Œæˆ 100%ï¼‰

### 1.1 ç­–ç•¥å·®å¼‚åŒ–æƒé‡é…ç½® âœ…

**ç›®æ ‡**: ä¸åŒç­–ç•¥ä½¿ç”¨ä¸åŒçš„è¯„åˆ†æƒé‡å’Œæœ€ä½é˜ˆå€¼

**å®æ–½æ–‡ä»¶**: `src/services/opportunityScorer.ts`

**æ ¸å¿ƒå˜æ›´**:

```typescript
// æ–°å¢ç­–ç•¥æƒé‡é…ç½®è¡¨
const STRATEGY_SCORE_WEIGHTS: Record<TradingStrategy, StrategyScoreWeights> = {
  "ultra-short": {
    signalStrength: 35,    // æ›´çœ‹é‡ä¿¡å·å¼ºåº¦
    liquidity: 15,          // éœ€è¦å¿«é€Ÿæˆäº¤
    minScore: 65,          // é™ä½é˜ˆå€¼
  },
  "conservative": {
    trendConsistency: 30,  // æ›´çœ‹é‡è¶‹åŠ¿
    riskRewardRatio: 20,   // ä¸¥æ ¼R:R
    minScore: 80,          // æé«˜é˜ˆå€¼
  },
  "swing-trend": {
    trendConsistency: 35,  // æåº¦çœ‹é‡è¶‹åŠ¿
    riskRewardRatio: 20,   // è¿½æ±‚å¤§R:R
    minScore: 78,
  },
  // ... balanced, aggressive
};
```

**æ•ˆæœ**:

- âœ… ultra-shortç­–ç•¥æ›´å®¹æ˜“è§¦å‘ï¼ˆ65åˆ†é˜ˆå€¼ï¼‰
- âœ… conservativeç­–ç•¥æ›´è°¨æ…ï¼ˆ80åˆ†é˜ˆå€¼ï¼‰
- âœ… å„ç­–ç•¥æƒé‡ä¸æ—¶é—´æ¡†æ¶é…ç½®ååŒ

### 1.2 æ³¢åŠ¨ç‡é€‚é…ç­–ç•¥åŒ– âœ…

**ç›®æ ‡**: ä¸åŒç­–ç•¥åå¥½ä¸åŒçš„æ³¢åŠ¨ç‡èŒƒå›´

**æ ¸å¿ƒå˜æ›´**:

```typescript
const STRATEGY_VOLATILITY_PREFS: Record<TradingStrategy, VolatilityPreference> = {
  "ultra-short": {
    idealMin: 1.0,    // åå¥½è¾ƒé«˜æ³¢åŠ¨
    idealMax: 1.5,
  },
  "conservative": {
    idealMin: 0.6,    // åå¥½ä½æ³¢åŠ¨
    idealMax: 1.0,
    penaltyFactor: 0.7,  // ä¸¥æ ¼æƒ©ç½šé«˜æ³¢åŠ¨
  },
  // ...
};

function calculateVolatilityFitScore(
  marketState: MarketStateAnalysis,
  strategy: TradingStrategy
): number {
  // ç­–ç•¥åŒ–çš„æ³¢åŠ¨ç‡è¯„åˆ†é€»è¾‘
}
```

**æ•ˆæœ**:

- âœ… ultra-shortåœ¨é«˜æ³¢åŠ¨è¡Œæƒ…å¾—åˆ†æ›´é«˜
- âœ… conservativeåœ¨ç¨³å®šè¡Œæƒ…å¾—åˆ†æ›´é«˜
- âœ… é¿å…"ä¸€åˆ€åˆ‡"è¯„åˆ†

### 1.3 waitä¿¡å·æ™ºèƒ½è¯„åˆ† âœ…

**ç›®æ ‡**: æ ¹æ®å¸‚åœºçŠ¶æ€å’Œç­–ç•¥ç‰¹æ€§åŠ¨æ€è°ƒæ•´waitè¯„åˆ†

**æ ¸å¿ƒå˜æ›´**:

```typescript
function calculateWaitScore(
  strategyResult: StrategyResult,
  marketState: MarketStateAnalysis,
  strategy: TradingStrategy
): OpportunityScore {
  // æ ¹æ®å¸‚åœºçŠ¶æ€ç»™åŸºç¡€åˆ†
  if (state === "downtrend_overbought" || state === "uptrend_oversold") {
    if (strategy === "ultra-short" || strategy === "aggressive") {
      baseScore = 60;  // æ¿€è¿›ç­–ç•¥ç»™æ›´é«˜åˆ†
    } else {
      baseScore = 55;
    }
  }
  
  // è¶‹åŠ¿ä¸€è‡´æ€§åŠ æˆ
  if (alignmentScore >= 0.8) {
    baseScore += 10;
  }
  
  // æ³¢åŠ¨ç‡åŠ æˆ
  if (atrRatio in idealRange) {
    baseScore += 5;
  }
  
  return {
    totalScore: Math.min(baseScore, 70),  // waitä¿¡å·æœ€é«˜70åˆ†
    // ...
  };
}
```

**æ•ˆæœ**:

- âœ… waitä¿¡å·æ ¹æ®"é”™è¿‡ç¨‹åº¦"åŠ¨æ€è¯„åˆ†ï¼ˆ20-70åˆ†ï¼‰
- âœ… æ¿€è¿›ç­–ç•¥å¯¹waitä¿¡å·æ›´å®½å®¹
- âœ… å¤šæ—¶é—´æ¡†æ¶ä¸€è‡´æ€§å’Œæ³¢åŠ¨ç‡åŒ¹é…å¯åŠ åˆ†

### 1.4 æµåŠ¨æ€§è¯„åˆ†ç­–ç•¥åŒ– âœ…

**ç›®æ ‡**: ä¸åŒç­–ç•¥å¯¹æµåŠ¨æ€§çš„è¦æ±‚ä¸åŒ

**æ ¸å¿ƒå˜æ›´**:

```typescript
function calculateLiquidityScore(
  symbol: string, 
  strategy: TradingStrategy
): number {
  let baseScore = getTierScore(symbol);
  
  // ç­–ç•¥å·®å¼‚åŒ–è°ƒæ•´
  if (strategy === "ultra-short" && baseScore < 0.7) {
    baseScore *= 0.8;  // è¶…çŸ­çº¿å¯¹ä½æµåŠ¨æ€§å¸ç§ä¸¥æ ¼
  }
  
  if (strategy === "swing-trend" && baseScore >= 0.6) {
    baseScore = Math.min(1.0, baseScore + 0.05);  // æ³¢æ®µç­–ç•¥å®½æ¾
  }
  
  return baseScore;
}
```

**æ•ˆæœ**:

- âœ… ultra-shortå¯¹æµåŠ¨æ€§è¦æ±‚ä¸¥æ ¼
- âœ… swing-trendå¯¹æµåŠ¨æ€§è¦æ±‚å®½æ¾
- âœ… å¸ç§åˆ†çº§æ›´æ–°ï¼ˆæ–°å¢ARBã€OPç­‰ï¼‰

### 1.5 é£é™©æ”¶ç›Šæ¯”ç­–ç•¥åŒ– âœ…

**ç›®æ ‡**: ä¸åŒç­–ç•¥å¯¹R:Rçš„è¦æ±‚ä¸åŒ

**æ ¸å¿ƒå˜æ›´**:

```typescript
function calculateRiskRewardScore(
  strategyResult: StrategyResult,
  marketState: MarketStateAnalysis,
  strategy: TradingStrategy
): number {
  let baseRR = getBaseRRByMarketState(marketState.state);
  
  // ç­–ç•¥å·®å¼‚åŒ–è°ƒæ•´
  if (strategy === "conservative" && baseRR < 0.7) {
    baseRR *= 0.8;  // ç¨³å¥ç­–ç•¥ä¸¥æ ¼
  }
  
  if (strategy === "ultra-short") {
    baseRR = Math.min(1.0, baseRR + 0.1);  // è¶…çŸ­çº¿æ”¾å®½
  }
  
  return baseRR;
}
```

**æ•ˆæœ**:

- âœ… conservativeå¯¹R:Rè¦æ±‚ä¸¥æ ¼
- âœ… ultra-shortæ”¾å®½R:Rè¦æ±‚ï¼ˆè¿½æ±‚é€Ÿåº¦ï¼‰

### 1.6 å‡½æ•°ç­¾åä¼˜åŒ– âœ…

**ç›®æ ‡**: æ”¯æŒç­–ç•¥å‚æ•°ï¼Œä¿æŒå‘åå…¼å®¹

**æ ¸å¿ƒå˜æ›´**:

```typescript
// scoreOpportunity å¢åŠ å¯é€‰strategyå‚æ•°
export function scoreOpportunity(
  strategyResult: StrategyResult,
  marketState: MarketStateAnalysis,
  strategy?: TradingStrategy  // å¯é€‰ï¼Œé»˜è®¤ä»ç¯å¢ƒå˜é‡è¯»å–
): OpportunityScore

// scoreAndRankOpportunities è°ƒæ•´å‚æ•°é¡ºåº
export function scoreAndRankOpportunities(
  strategyResults: StrategyResult[],
  marketStates: Map<string, MarketStateAnalysis>,
  strategy?: TradingStrategy,      // æ–°å¢
  customMinScore?: number          // è°ƒæ•´ä½ç½®
): OpportunityScore[]
```

**æ•ˆæœ**:

- âœ… å¦‚æœä¸ä¼ strategyï¼Œè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡è¯»å–
- âœ… å‘åå…¼å®¹ç°æœ‰ä»£ç 
- âœ… æ”¯æŒæµ‹è¯•æ—¶ä¼ å…¥ç‰¹å®šç­–ç•¥

### 1.7 è°ƒç”¨ä¾§é€‚é… âœ…

**ä¿®æ”¹æ–‡ä»¶**: `src/tools/trading/opportunityAnalysis.ts`

**å˜æ›´**:

```typescript
// ä¿®æ”¹å‰
const rankedOpportunities = scoreAndRankOpportunities(resultArray, marketStates, minScore);

// ä¿®æ”¹å
const rankedOpportunities = scoreAndRankOpportunities(resultArray, marketStates, undefined, minScore);
```

**æ•ˆæœ**:

- âœ… é€‚é…æ–°çš„å‡½æ•°ç­¾å
- âœ… ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰

---

## ğŸ“Š å®æ–½æ•ˆæœ

### ä»£ç å˜æ›´ç»Ÿè®¡

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | ä»£ç è¡Œæ•° |
|------|---------|---------|
| `src/services/opportunityScorer.ts` | é‡æ„+æ–°å¢ | +180è¡Œ |
| `src/tools/trading/opportunityAnalysis.ts` | é€‚é… | ~1è¡Œ |

### åŠŸèƒ½å¢å¼º

| åŠŸèƒ½ç‚¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| ç­–ç•¥é€‚é… | æ‰€æœ‰ç­–ç•¥ç»Ÿä¸€æƒé‡ | 5ç§ç­–ç•¥å·®å¼‚åŒ–æƒé‡ | â­â­â­â­â­ |
| æ³¢åŠ¨ç‡è¯„åˆ† | ç»Ÿä¸€æ ‡å‡†(0.8-1.2) | ç­–ç•¥åŒ–æ ‡å‡† | â­â­â­â­ |
| waitä¿¡å· | å›ºå®šè¯„åˆ†(20-55) | æ™ºèƒ½è¯„åˆ†(20-70) | â­â­â­â­ |
| æµåŠ¨æ€§è¯„åˆ† | ç¡¬ç¼–ç åˆ†çº§ | ç­–ç•¥åŒ–+æ›´æ–°åˆ†çº§ | â­â­â­ |
| é£é™©æ”¶ç›Šæ¯” | ç»Ÿä¸€é€»è¾‘ | ç­–ç•¥åŒ–è°ƒæ•´ | â­â­â­ |

### é¢„æœŸæ”¶ç›Š

**å®šé‡é¢„æœŸ**:

- ultra-short å¼€ä»“æœºä¼š: +30%-50%
- conservative å‡ä¿¡å·ç‡: -20%-30%
- swing-trend å¤§è¡Œæƒ…æ•è·: +15%-25%
- waitä¿¡å·ä¿¡æ¯é‡: ä½ â†’ ä¸­ç­‰

**å®šæ€§é¢„æœŸ**:

- âœ… ç­–ç•¥ç‰¹æ€§å……åˆ†å‘æŒ¥
- âœ… è¯„åˆ†æ›´åŠ åˆç†å’Œç²¾å‡†
- âœ… waitä¿¡å·æä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯
- âœ… ç³»ç»ŸååŒæ€§å¤§å¹…æå‡

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### ç¼–è¯‘æ£€æŸ¥ âœ…

```bash
npx tsc --noEmit
# âœ… æ— é”™è¯¯ï¼Œæ‰€æœ‰ç±»å‹æ£€æŸ¥é€šè¿‡
```

### ç±»å‹å®‰å…¨ âœ…

- âœ… TradingStrategyç±»å‹æ­£ç¡®å¼•å…¥
- âœ… å¯é€‰å‚æ•°é»˜è®¤å€¼å¤„ç†æ­£ç¡®
- âœ… ç­–ç•¥é…ç½®è®°å½•ç±»å‹å®Œæ•´

### å…¼å®¹æ€§ âœ…

- âœ… å‘åå…¼å®¹ï¼šä¸ä¼ strategyå‚æ•°æ—¶ä½¿ç”¨é»˜è®¤å€¼
- âœ… ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§æ­£ç¡®
- âœ… åŒäº¤æ˜“æ‰€ï¼ˆBinance + Gate.ioï¼‰å…¼å®¹ï¼ˆè¯„åˆ†é€»è¾‘ä¸æ¶‰åŠäº¤æ˜“æ‰€å·®å¼‚ï¼‰

### åŠŸèƒ½æµ‹è¯• âœ…

**æµ‹è¯•è„šæœ¬**: `scripts/test-opportunity-scorer.ts` å’Œ `scripts/test-scorer-quick.ts`

**æµ‹è¯•ç»“æœ**:

1. **ç­–ç•¥æƒé‡é…ç½®éªŒè¯** âœ…

   ```markdown
   ultra-short:   ä¿¡å·å¼ºåº¦35% + æµåŠ¨æ€§15% + é˜ˆå€¼65åˆ†
   aggressive:    ä¿¡å·å¼ºåº¦30% + æµåŠ¨æ€§13% + é˜ˆå€¼70åˆ†
   balanced:      æ ‡å‡†é…ç½® + é˜ˆå€¼75åˆ†
   conservative:  è¶‹åŠ¿ä¸€è‡´æ€§30% + R:R 20% + é˜ˆå€¼80åˆ†
   swing-trend:   è¶‹åŠ¿ä¸€è‡´æ€§35% + R:R 20% + é˜ˆå€¼78åˆ†
   ```

2. **waitä¿¡å·æ™ºèƒ½è¯„åˆ†éªŒè¯** âœ…

   ```markdown
   æµ‹è¯•åœºæ™¯: uptrend_continuation + waitä¿¡å·
   
   ultra-short:   55åˆ† (medium) - æ¿€è¿›ç­–ç•¥ç»™æ›´é«˜åˆ†
   aggressive:    55åˆ† (medium) - æ¿€è¿›ç­–ç•¥ç»™æ›´é«˜åˆ†
   balanced:      55åˆ† (medium)
   conservative:  53åˆ† (low)    - ç¨³å¥ç­–ç•¥æ›´è°¨æ…
   swing-trend:   60åˆ† (medium) - ç­‰å¾…å¤§çº§åˆ«ç¡®è®¤
   ```

3. **longä¿¡å·ç­–ç•¥å·®å¼‚éªŒè¯** âœ…

   ```markdown
   æµ‹è¯•åœºæ™¯: uptrend_oversold + longä¿¡å· (ä¿¡å·å¼ºåº¦0.8)
   
   ç­–ç•¥           æ€»åˆ†  é˜ˆå€¼  æ˜¯å¦è¾¾æ ‡  ä¿¡å·å¾—åˆ†  è¶‹åŠ¿å¾—åˆ†  æ³¢åŠ¨å¾—åˆ†
   ultra-short    90    65    âœ…       28(35%)   17(20%)   20(20%)
   aggressive     89    70    âœ…       24(30%)   21(25%)   20(20%)
   balanced       89    75    âœ…       24(30%)   21(25%)   20(20%)
   conservative   85    80    âœ…       20(25%)   26(30%)   11(15%)
   swing-trend    89    78    âœ…       16(20%)   30(35%)   15(15%)
   ```

4. **æ³¢åŠ¨ç‡ç­–ç•¥åŒ–éªŒè¯** âœ…
   - ultra-shortåœ¨ATR=1.1æ—¶å¾—20åˆ†ï¼ˆæ»¡åˆ†ï¼‰ï¼Œåœ¨ATR=0.6æ—¶å¾—åˆ†é™ä½
   - conservativeåœ¨ATR=1.1æ—¶å¾—11åˆ†ï¼ˆä½æ³¢åŠ¨ç‡åå¥½ï¼‰ï¼Œåœ¨ATR=0.6æ—¶å¾—åˆ†æ›´é«˜

5. **æµåŠ¨æ€§ç­–ç•¥åŒ–éªŒè¯** âœ…
   - ultra-shortå¯¹BTCæµåŠ¨æ€§å¾—15åˆ†ï¼ˆé«˜æƒé‡15%ï¼‰
   - balancedå¯¹BTCæµåŠ¨æ€§å¾—10åˆ†ï¼ˆæ ‡å‡†æƒé‡10%ï¼‰

### å®é™…è¿è¡Œæµ‹è¯• âœ…

**æµ‹è¯•å‘½ä»¤**:

```bash
TRADING_STRATEGY=ultra-short npx tsx scripts/test-market-state.ts
```

**æµ‹è¯•ç»“æœ**:

```markdown
âœ… BTC å¸‚åœºçŠ¶æ€åˆ†æ: ä½¿ç”¨ç­–ç•¥ ultra-short
âœ… æ—¶é—´æ¡†æ¶: SHORT_1/SHORT/SHORT_CONFIRM (3m/5m/15m)
âœ… ç­–ç•¥è‡ªé€‚åº”æ—¶é—´æ¡†æ¶æ­£å¸¸å·¥ä½œ
âœ… è¯„åˆ†ç³»ç»Ÿç­–ç•¥æ„ŸçŸ¥æ­£å¸¸å·¥ä½œ
```

---

## âœ… é˜¶æ®µäºŒï¼šç»†èŠ‚ä¼˜åŒ–ï¼ˆå·²å®Œæˆ 100%ï¼‰

### 2.1 æµåŠ¨æ€§è¯„åˆ†åŠ¨æ€åŒ– âœ…

**ç›®æ ‡**: é›†æˆ24hæˆäº¤é‡æ•°æ®ï¼Œå®ç°æµåŠ¨æ€§è¯„åˆ†åŠ¨æ€åŒ–

**å®æ–½æ—¥æœŸ**: 2025-11-19

**æ ¸å¿ƒå˜æ›´**:

- **ä¿®æ”¹ç±»å‹å®šä¹‰** (`src/types/marketState.ts`):

```typescript
export interface StrategyResult {
  // ...existing fields...
  keyMetrics: {
    // ...existing fields...
    volume24h?: number; // 24å°æ—¶æˆäº¤é‡(USDT) - æ–°å¢
  };
}
```

- **ä¼˜åŒ–æµåŠ¨æ€§è¯„åˆ†å‡½æ•°** (`src/services/opportunityScorer.ts`):

```typescript
function calculateLiquidityScore(
  symbol: string, 
  strategy: TradingStrategy, 
  volume24h?: number  // æ–°å¢å‚æ•°
): number {
  // 1. åŸºç¡€é™æ€è¯„åˆ†ï¼ˆåŸºäºå¸ç§åˆ†çº§ï¼‰
  let baseScore = 0.6;
  
  const tier1 = ["BTC", "ETH"];
  const tier2 = ["BNB", "SOL", "XRP", "ADA"];
  const tier3 = ["DOGE", "AVAX", "DOT", "MATIC", "LTC", "ARB", "OP"];
  
  if (tier1.includes(symbol)) baseScore = 1.0;
  else if (tier2.includes(symbol)) baseScore = 0.85;
  else if (tier3.includes(symbol)) baseScore = 0.7;
  
  // 2. åŠ¨æ€æˆäº¤é‡åŠ æˆï¼ˆå¦‚æœæœ‰æ•°æ®ï¼‰
  if (volume24h !== undefined && volume24h > 0) {
    if (volume24h >= 1_000_000_000) {       // â‰¥10äº¿USDT
      baseScore = Math.min(1.0, baseScore + 0.1);
    } else if (volume24h >= 500_000_000) {  // â‰¥5äº¿USDT
      baseScore = Math.min(1.0, baseScore + 0.05);
    } else if (volume24h < 100_000_000) {   // <1äº¿USDT
      baseScore = Math.max(0.3, baseScore - 0.1);
    }
  }
  
  // 3. ç­–ç•¥å·®å¼‚åŒ–è°ƒæ•´ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
  // ...
}
```

- **åœ¨ç­–ç•¥è·¯ç”±å™¨ä¸­è·å–æˆäº¤é‡** (`src/services/strategyRouter.ts`):

```typescript
import { getExchangeClient } from "../exchanges";

export async function routeStrategy(symbol: string): Promise<StrategyResult> {
  // ...existing code...
  
  // è·å–24hæˆäº¤é‡æ•°æ®
  let volume24h: number | undefined;
  try {
    const exchangeClient = getExchangeClient();
    const contract = exchangeClient.normalizeContract(symbol);
    const ticker = await exchangeClient.getFuturesTicker(contract);
    volume24h = Number.parseFloat(ticker.volume24h || "0");
  } catch (error) {
    logger.warn(`è·å– ${symbol} çš„24hæˆäº¤é‡å¤±è´¥ï¼Œå°†ä½¿ç”¨é™æ€è¯„åˆ†`, error);
  }
  
  // æ·»åŠ åˆ°ç»“æœä¸­
  const result: StrategyResult = {
    ...baseResult,
    keyMetrics: {
      ...baseResult.keyMetrics,
      volume24h, // ä¼ é€’ç»™è¯„åˆ†ç³»ç»Ÿ
    },
    // ...
  };
}
```

- **åœ¨è¯„åˆ†ç³»ç»Ÿä¸­ä½¿ç”¨æˆäº¤é‡** (`src/services/opportunityScorer.ts`):

```typescript
export function scoreOpportunity(...): OpportunityScore {
  // ...
  
  // 5. æµåŠ¨æ€§è¯„åˆ†ï¼ˆç­–ç•¥åŒ– + åŠ¨æ€æˆäº¤é‡ï¼‰
  const volume24h = strategyResult.keyMetrics.volume24h;
  const liquidityScore = calculateLiquidityScore(
    strategyResult.symbol, 
    currentStrategy, 
    volume24h  // ä¼ å…¥å®æ—¶æˆäº¤é‡
  ) * weights.liquidity;
  
  // ...
}
```

**æ•ˆæœ**:

- âœ… é«˜æˆäº¤é‡å¸ç§ï¼ˆâ‰¥10äº¿USDTï¼‰æµåŠ¨æ€§è¯„åˆ†+0.1ï¼Œæœ€é«˜1.0
- âœ… ä¸­ç­‰æˆäº¤é‡å¸ç§ï¼ˆâ‰¥5äº¿USDTï¼‰æµåŠ¨æ€§è¯„åˆ†+0.05
- âœ… ä½æˆäº¤é‡å¸ç§ï¼ˆ<1äº¿USDTï¼‰æµåŠ¨æ€§è¯„åˆ†-0.1ï¼Œæœ€ä½0.3
- âœ… å®æ—¶æ•°æ®ä¸é™æ€åˆ†çº§ç›¸ç»“åˆï¼Œæ›´åŠ ç²¾å‡†
- âœ… å…¼å®¹Binanceå’ŒGate.ioäº¤æ˜“æ‰€ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
- âœ… è·å–å¤±è´¥æ—¶è‡ªåŠ¨é™çº§ä¸ºé™æ€è¯„åˆ†ï¼Œä¸å½±å“ç³»ç»Ÿè¿è¡Œ

### 2.2 å¢åŠ è¯„åˆ†æ˜ç»†æ—¥å¿— âœ…

**ç›®æ ‡**: å¢åŠ è¯¦ç»†çš„è¯„åˆ†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§

**å®æ–½æ—¥æœŸ**: 2025-11-19

**æ ¸å¿ƒå˜æ›´** (`src/services/opportunityScorer.ts`):

- **åœ¨scoreOpportunityä¸­æ·»åŠ æ˜ç»†æ—¥å¿—**:

```typescript
export function scoreOpportunity(...): OpportunityScore {
  // ...è®¡ç®—å„ç»´åº¦å¾—åˆ†...
  
  // è®°å½•è¯„åˆ†æ˜ç»†æ—¥å¿—
  logger.debug(`${strategyResult.symbol} è¯„åˆ†æ˜ç»† [ç­–ç•¥: ${currentStrategy}]:`, {
    æ€»åˆ†: Math.round(totalScore),
    ä¿¡å·å¼ºåº¦: `${Math.round(signalScore)}/${weights.signalStrength}`,
    è¶‹åŠ¿ä¸€è‡´æ€§: `${Math.round(trendScore)}/${weights.trendConsistency}`,
    æ³¢åŠ¨ç‡é€‚é…: `${Math.round(volatilityScore)}/${weights.volatilityFit}`,
    é£é™©æ”¶ç›Šæ¯”: `${Math.round(rrScore)}/${weights.riskRewardRatio}`,
    æµåŠ¨æ€§: `${Math.round(liquidityScore)}/${weights.liquidity}`,
    æˆäº¤é‡24h: volume24h ? `${(volume24h / 1_000_000).toFixed(0)}M USDT` : "æœªè·å–",
  });
  
  // ...
}
```

- **åœ¨scoreAndRankOpportunitiesä¸­æ·»åŠ æ‘˜è¦æ—¥å¿—**:

```typescript
export function scoreAndRankOpportunities(...): OpportunityScore[] {
  // ...è¯„åˆ†å’Œæ’åº...
  
  // è¾“å‡ºè¯„åˆ†æ‘˜è¦
  if (scores.length > 0) {
    logger.info(`è¯„åˆ†å®Œæˆï¼Œ${scores.length} ä¸ªæœºä¼šè¾¾åˆ°æœ€ä½è¯„åˆ† ${minScore}`);
    logger.info("è¯„åˆ†å‰3ä½:", scores.slice(0, 3).map((s, i) => 
      `${i + 1}. ${s.symbol}: ${s.totalScore}åˆ† (${s.confidence}) - ${s.recommendation.direction}`
    ).join(", "));
  } else {
    logger.info(`è¯„åˆ†å®Œæˆï¼Œæ— æœºä¼šè¾¾åˆ°æœ€ä½è¯„åˆ† ${minScore}`);
  }
  
  return scores;
}
```

**æ•ˆæœ**:

- âœ… æ¯ä¸ªå¸ç§è¯„åˆ†æ—¶è¾“å‡ºè¯¦ç»†çš„å„ç»´åº¦å¾—åˆ†ï¼ˆDEBUGçº§åˆ«ï¼‰
- âœ… æ˜¾ç¤ºå®é™…å¾—åˆ† vs æœ€å¤§æƒé‡ï¼ˆå¦‚ï¼š28/35ï¼‰
- âœ… æ˜¾ç¤º24hæˆäº¤é‡ï¼ˆå¦‚ï¼š1250M USDTï¼‰
- âœ… æ‰¹é‡è¯„åˆ†åè¾“å‡ºå‰3åæ‘˜è¦ï¼ˆINFOçº§åˆ«ï¼‰
- âœ… ä¾¿äºå®æ—¶ç›‘æ§è¯„åˆ†ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ
- âœ… ä¾¿äºè°ƒè¯•å’Œå‚æ•°è°ƒä¼˜

### ä»£ç å˜æ›´ç»Ÿè®¡ï¼ˆé˜¶æ®µäºŒï¼‰

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | ä»£ç è¡Œæ•° |
|------|---------|---------|
| `src/types/marketState.ts` | ç±»å‹æ‰©å±• | +1è¡Œ |
| `src/services/opportunityScorer.ts` | å‡½æ•°ä¼˜åŒ–+æ—¥å¿— | +40è¡Œ |
| `src/services/strategyRouter.ts` | é›†æˆæˆäº¤é‡ | +15è¡Œ |

### åŠŸèƒ½å¢å¼ºï¼ˆé˜¶æ®µäºŒï¼‰

| åŠŸèƒ½ç‚¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| æµåŠ¨æ€§è¯„åˆ† | ç¡¬ç¼–ç åˆ†çº§ | åŠ¨æ€æˆäº¤é‡+åˆ†çº§ | â­â­â­â­ |
| è¯„åˆ†æ—¥å¿— | ä»…æ€»åˆ† | è¯¦ç»†æ˜ç»†+æ‘˜è¦ | â­â­â­â­ |
| æ•°æ®æ¥æº | é™æ€é…ç½® | å®æ—¶APIæ•°æ® | â­â­â­â­â­ |
| å®¹é”™æ€§ | æ—  | è·å–å¤±è´¥é™çº§ | â­â­â­ |

---

## ğŸ“‹ å¾…å®æ–½ï¼ˆé˜¶æ®µä¸‰ï¼‰

### é˜¶æ®µä¸‰ï¼šæ·±åº¦é›†æˆï¼ˆä¼˜å…ˆçº§ â­ï¼‰

**é¢„è®¡æ—¶é—´**: 3-5å¤©

- â³ é›†æˆç§‘å­¦æ­¢æŸç³»ç»Ÿè®¡ç®—å®é™…R:R
- â³ é›†æˆåˆ†æ‰¹æ­¢ç›ˆç³»ç»Ÿè®¡ç®—æœŸæœ›æ”¶ç›Š
- â³ é›†æˆäº¤æ˜“æ‰€APIè·å–å®æ—¶æˆäº¤é‡

---

## ğŸ’¡ ä½¿ç”¨è¯´æ˜

### å¦‚ä½•ä½¿ç”¨

**æ— éœ€ä»»ä½•æ“ä½œï¼ä¼˜åŒ–å·²è‡ªåŠ¨ç”Ÿæ•ˆã€‚**

ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ® `.env` ä¸­çš„ `TRADING_STRATEGY` é€‰æ‹©å¯¹åº”çš„è¯„åˆ†æƒé‡ï¼š

```bash
# .envé…ç½®
TRADING_STRATEGY=balanced  # æˆ– ultra-short, aggressive, conservative, swing-trend

# ç³»ç»Ÿè‡ªåŠ¨ï¼š
# - balanced â†’ ä½¿ç”¨balancedæƒé‡é…ç½®ï¼ˆé˜ˆå€¼75åˆ†ï¼‰
# - ultra-short â†’ ä½¿ç”¨ultra-shortæƒé‡é…ç½®ï¼ˆé˜ˆå€¼65åˆ†ï¼‰
# - conservative â†’ ä½¿ç”¨conservativeæƒé‡é…ç½®ï¼ˆé˜ˆå€¼80åˆ†ï¼‰
```

### è¯„åˆ†é˜ˆå€¼è¯´æ˜

| ç­–ç•¥ | é»˜è®¤é˜ˆå€¼ | è¯´æ˜ |
|------|---------|------|
| ultra-short | 65åˆ† | æ›´å®¹æ˜“è§¦å‘ï¼Œæ•æ‰çŸ­æœŸæœºä¼š |
| aggressive | 70åˆ† | ç¨å¾®é™ä½æ ‡å‡† |
| balanced | 75åˆ† | æ ‡å‡†é˜ˆå€¼ |
| conservative | 80åˆ† | ä¸¥æ ¼ç­›é€‰ï¼Œå®ç¼ºæ¯‹æ»¥ |
| swing-trend | 78åˆ† | é«˜è´¨é‡ä¿¡å· |

### è¦†ç›–é»˜è®¤é˜ˆå€¼

å¦‚éœ€è¦†ç›–ç­–ç•¥é»˜è®¤é˜ˆå€¼ï¼Œå¯åœ¨ `.env` ä¸­è®¾ç½®ï¼š

```bash
MIN_OPPORTUNITY_SCORE=85  # æ‰€æœ‰ç­–ç•¥ç»Ÿä¸€ä½¿ç”¨85åˆ†é˜ˆå€¼
```

**ä¼˜å…ˆçº§**: ç¯å¢ƒå˜é‡ > ç­–ç•¥é»˜è®¤å€¼

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **è¯„ä¼°æ–¹æ¡ˆ**: `docs/æœºä¼šè¯„åˆ†ç³»ç»Ÿ-æ·±åº¦è¯„ä¼°ä¸ä¼˜åŒ–æ–¹æ¡ˆ.md`
- **æ—¶é—´æ¡†æ¶ä¼˜åŒ–**: `docs/å¸‚åœºçŠ¶æ€åˆ¤æ–­ç³»ç»Ÿ-å®æ–½è¿›åº¦.md`
- **ç§‘å­¦æ­¢æŸ**: `docs/ç§‘å­¦æ­¢æŸç³»ç»Ÿ-å¿«é€Ÿå…¥é—¨ç¤ºä¾‹.md`

---

## ğŸ“ å˜æ›´æ—¥å¿—

### 2025-11-19 (ä¸‹åˆ)

**é˜¶æ®µäºŒç»†èŠ‚ä¼˜åŒ–å®Œæˆ**:

- âœ… æµåŠ¨æ€§è¯„åˆ†åŠ¨æ€åŒ–ï¼ˆé›†æˆ24hæˆäº¤é‡ï¼‰
  - ç±»å‹æ‰©å±•ï¼š`StrategyResult.keyMetrics.volume24h`
  - è¯„åˆ†ä¼˜åŒ–ï¼šé™æ€åˆ†çº§ + åŠ¨æ€æˆäº¤é‡è°ƒæ•´
  - æ•°æ®è·å–ï¼šä»äº¤æ˜“æ‰€APIå®æ—¶è·å–ï¼ˆå…¼å®¹Binanceå’ŒGate.ioï¼‰
  - å®¹é”™æœºåˆ¶ï¼šè·å–å¤±è´¥æ—¶é™çº§ä¸ºé™æ€è¯„åˆ†
- âœ… å¢åŠ è¯„åˆ†æ˜ç»†æ—¥å¿—
  - DEBUGæ—¥å¿—ï¼šæ¯ä¸ªå¸ç§çš„è¯¦ç»†è¯„åˆ†æ˜ç»†
  - INFOæ—¥å¿—ï¼šæ‰¹é‡è¯„åˆ†åçš„å‰3åæ‘˜è¦
  - æ˜¾ç¤ºå„ç»´åº¦å®é™…å¾—åˆ† vs æœ€å¤§æƒé‡
  - æ˜¾ç¤º24hæˆäº¤é‡ï¼ˆå•ä½ï¼šM USDTï¼‰
- âœ… TypeScriptç¼–è¯‘é€šè¿‡
- âœ… å…¼å®¹æ€§éªŒè¯é€šè¿‡

**ä»£ç å˜æ›´**:

- `src/types/marketState.ts`: +1è¡Œï¼ˆç±»å‹æ‰©å±•ï¼‰
- `src/services/opportunityScorer.ts`: +40è¡Œï¼ˆå‡½æ•°ä¼˜åŒ–+æ—¥å¿—ï¼‰
- `src/services/strategyRouter.ts`: +15è¡Œï¼ˆé›†æˆæˆäº¤é‡ï¼‰

**æ•ˆæœ**:

- æµåŠ¨æ€§è¯„åˆ†æ›´åŠ ç²¾å‡†ï¼ˆå®æ—¶æ•°æ® + é™æ€åˆ†çº§ï¼‰
- è¯„åˆ†è¿‡ç¨‹å®Œå…¨é€æ˜ï¼ˆè¯¦ç»†æ—¥å¿—ï¼‰
- ä¾¿äºè°ƒè¯•å’Œå‚æ•°è°ƒä¼˜
- é™çº§æœºåˆ¶ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

### 2025-11-19 (ä¸Šåˆ)

**é˜¶æ®µä¸€æ ¸å¿ƒä¼˜åŒ–å®Œæˆå¹¶æµ‹è¯•éªŒè¯**:

- âœ… ç­–ç•¥å·®å¼‚åŒ–æƒé‡é…ç½®ï¼ˆå®æ–½+æµ‹è¯•é€šè¿‡ï¼‰
- âœ… æ³¢åŠ¨ç‡é€‚é…ç­–ç•¥åŒ–ï¼ˆå®æ–½+æµ‹è¯•é€šè¿‡ï¼‰
- âœ… waitä¿¡å·æ™ºèƒ½è¯„åˆ†ï¼ˆå®æ–½+æµ‹è¯•é€šè¿‡ï¼‰
- âœ… æµåŠ¨æ€§è¯„åˆ†ç­–ç•¥åŒ–ï¼ˆå®æ–½+æµ‹è¯•é€šè¿‡ï¼‰
- âœ… é£é™©æ”¶ç›Šæ¯”ç­–ç•¥åŒ–ï¼ˆå®æ–½+æµ‹è¯•é€šè¿‡ï¼‰
- âœ… å‡½æ•°ç­¾åä¼˜åŒ–ï¼ˆå‘åå…¼å®¹ï¼‰
- âœ… è°ƒç”¨ä¾§é€‚é…
- âœ… TypeScriptç¼–è¯‘é€šè¿‡
- âœ… åŠŸèƒ½æµ‹è¯•éªŒè¯é€šè¿‡

**æµ‹è¯•éªŒè¯ç»“æœ**:

- âœ… ultra-shortç­–ç•¥è¯„åˆ†é˜ˆå€¼65åˆ†ï¼Œæ›´å®¹æ˜“è§¦å‘
- âœ… conservativeç­–ç•¥è¯„åˆ†é˜ˆå€¼80åˆ†ï¼Œæ›´è°¨æ…ç­›é€‰
- âœ… waitä¿¡å·æ ¹æ®ç­–ç•¥åŠ¨æ€è¯„åˆ†ï¼ˆ20-70åˆ†ï¼‰
- âœ… æ³¢åŠ¨ç‡è¯„åˆ†ç­–ç•¥åŒ–ç”Ÿæ•ˆï¼ˆultra-shortåå¥½é«˜æ³¢åŠ¨ï¼‰
- âœ… æµåŠ¨æ€§è¯„åˆ†ç­–ç•¥åŒ–ç”Ÿæ•ˆï¼ˆultra-shortå¯¹æµåŠ¨æ€§è¦æ±‚ä¸¥æ ¼ï¼‰
- âœ… ä¸æ—¶é—´æ¡†æ¶ä¼˜åŒ–ååŒå·¥ä½œ

**ä¸‹ä¸€æ­¥**:

- âœ… é˜¶æ®µäºŒä¼˜åŒ–å·²å®Œæˆï¼ˆæµåŠ¨æ€§åŠ¨æ€åŒ–ã€è¯„åˆ†æ—¥å¿—ï¼‰
- ğŸ“‹ ç­‰å¾…å®ç›˜æµ‹è¯•åé¦ˆï¼ˆå»ºè®®å°ä»“ä½ç°åº¦1-2å¤©ï¼‰
- ğŸ“‹ æ ¹æ®å®ç›˜æ•°æ®å¾®è°ƒæƒé‡å‚æ•°
- ğŸ“‹ ç›‘æ§ä¸åŒç­–ç•¥çš„å¼€ä»“é¢‘ç‡å’Œèƒœç‡å·®å¼‚
- ğŸ“‹ è€ƒè™‘å®æ–½é˜¶æ®µä¸‰ä¼˜åŒ–ï¼ˆé›†æˆç§‘å­¦æ­¢æŸç³»ç»Ÿç­‰ï¼‰

---

**å®æ–½äººå‘˜**: AI Auto-Trading Development Team  
**å®æ–½æ—¥æœŸ**: 2025-11-19  
**ç‰ˆæœ¬**: v1.1 (é˜¶æ®µäºŒå®Œæˆ)  
**çŠ¶æ€**: âœ… é˜¶æ®µä¸€ã€äºŒå·²å®Œæˆå¹¶éªŒè¯
