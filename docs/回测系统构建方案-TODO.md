# çµæ¢é‡åŒ–å›æµ‹ç³»ç»Ÿæ„å»ºæ–¹æ¡ˆ - TODO

## ğŸ“‹ é¡¹ç›®ç›®æ ‡

æ„å»ºä¸€ä¸ª**åŸºäºå½“å‰æ¶æ„ã€è´´åˆçœŸå®ç¯å¢ƒ**çš„å›æµ‹ç³»ç»Ÿï¼Œæœ€å¤§é™åº¦ç¼©å°"æµ‹è¯•ç¾å¥½"ä¸"å®ç›˜éª¨æ„Ÿ"ä¹‹é—´çš„å·®è·ï¼Œå®ç°ï¼š

- âœ… å¿«é€ŸéªŒè¯ç­–ç•¥é€»è¾‘ï¼ˆå°æ—¶çº§ vs å‘¨/æœˆçº§ï¼‰
- âœ… å‘ç°æ˜æ˜¾æ— æ•ˆçš„æƒ³æ³•ï¼Œé¿å…æµªè´¹æµ‹è¯•ç½‘èµ„æº
- âœ… é‡åŒ–è¯„ä¼° AI å†³ç­–è´¨é‡
- âœ… ä¼˜åŒ–ç­–ç•¥å‚æ•°å’Œé£æ§å‚æ•°
- âœ… è¯†åˆ«ç³»ç»Ÿæ€§é—®é¢˜å’Œè¾¹ç¼˜æ¡ˆä¾‹

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. æ¶æ„å¤ç”¨åŸåˆ™

- **å¤ç”¨ç°æœ‰ä»£ç **ï¼šæœ€å¤§é™åº¦ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒçš„çœŸå®ä»£ç 
- **ç»Ÿä¸€æ¥å£è®¾è®¡**ï¼šå›æµ‹å’Œå®ç›˜ä½¿ç”¨ç›¸åŒçš„ Agentã€å·¥å…·ã€ç­–ç•¥
- **é¿å…ä»£ç åˆ†æ”¯**ï¼šä¸åˆ›å»º"å›æµ‹ä¸“ç”¨ç‰ˆæœ¬"ï¼Œç¡®ä¿ä¸€è‡´æ€§

### 2. çœŸå®æ€§åŸåˆ™

- **çœŸå®æ»‘ç‚¹æ¨¡æ‹Ÿ**ï¼šåŸºäºè®¢å•ç°¿æ·±åº¦è®¡ç®—æ»‘ç‚¹
- **çœŸå®æ‰‹ç»­è´¹**ï¼šMaker/Taker è´¹ç‡ï¼Œè€ƒè™‘ VIP ç­‰çº§
- **çœŸå®å»¶è¿Ÿ**ï¼šæ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿã€è®¢å•æ’®åˆå»¶è¿Ÿ
- **çœŸå®èµ„é‡‘çº¦æŸ**ï¼šä¿è¯é‡‘ã€æ æ†ã€å¼ºå¹³ä»·æ ¼è®¡ç®—
- **çœŸå®å¸‚åœºå†²å‡»**ï¼šå¤§å•å¯¹å¸‚åœºçš„å½±å“

### 3. AI å†³ç­–ä¿çœŸåŸåˆ™

- **ç›¸åŒè¾“å…¥æ•°æ®**ï¼šå›æµ‹ä½¿ç”¨ä¸å®ç›˜ç›¸åŒçš„æ•°æ®æ ¼å¼
- **ç›¸åŒå†³ç­–æµç¨‹**ï¼šè°ƒç”¨çœŸå®çš„ AI Agentï¼Œè€Œéæ¨¡æ‹Ÿè§„åˆ™
- **å®Œæ•´ä¸Šä¸‹æ–‡**ï¼šæä¾›ç›¸åŒçš„å¤šæ—¶é—´æ¡†æ¶ã€æŠ€æœ¯æŒ‡æ ‡ã€æŒä»“ä¿¡æ¯
- **å†³ç­–å¯è¿½æº¯**ï¼šè®°å½•æ¯ä¸ªå†³ç­–çš„æ¨ç†è¿‡ç¨‹

---

## ğŸ“ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```markdown
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Trading Agent (AI)                    â”‚
â”‚                  (ç”Ÿäº§ç¯å¢ƒçœŸå® Agent)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                   â”‚                                    â”‚
                   â”‚ (ç›¸åŒæ¥å£)                         â”‚
                   â”‚                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Live Trading Mode          â”‚    â”‚   Backtest Mode             â”‚
â”‚   (å®ç›˜/æµ‹è¯•ç½‘)              â”‚    â”‚   (å†å²æ•°æ®å›æ”¾)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Real Exchange API  â”‚              â”‚  Backtest Exchange Mock    â”‚
â”‚  - Gate.io          â”‚              â”‚  - å†å² Kçº¿æ•°æ®            â”‚
â”‚  - Binance          â”‚              â”‚  - è®¢å•ç°¿å¿«ç…§              â”‚
â”‚  - å®æ—¶è®¢å•ç°¿       â”‚              â”‚  - æ¨¡æ‹Ÿè®¢å•æ’®åˆ            â”‚
â”‚  - WebSocket æ•°æ®æµ â”‚              â”‚  - æ»‘ç‚¹/æ‰‹ç»­è´¹è®¡ç®—         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç»„ä»¶è®¾è®¡

```markdown
src/backtest/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ BacktestEngine.ts           # å›æµ‹å¼•æ“æ ¸å¿ƒ
â”‚   â”œâ”€â”€ TimeSimulator.ts            # æ—¶é—´æ¨¡æ‹Ÿå™¨ï¼ˆé€ Bar å›æ”¾ï¼‰
â”‚   â”œâ”€â”€ EventBus.ts                 # äº‹ä»¶æ€»çº¿ï¼ˆBar æ›´æ–°ã€è®¢å•æ‰§è¡Œã€æŒä»“å˜åŒ–ï¼‰
â”‚   â””â”€â”€ BacktestState.ts            # å›æµ‹çŠ¶æ€ç®¡ç†ï¼ˆè´¦æˆ·ã€æŒä»“ã€è®¢å•ï¼‰
â”œâ”€â”€ exchanges/
â”‚   â”œâ”€â”€ BacktestExchangeClient.ts   # æ¨¡æ‹Ÿäº¤æ˜“æ‰€å®¢æˆ·ç«¯ï¼ˆå®ç° IExchangeClientï¼‰
â”‚   â”œâ”€â”€ OrderMatcher.ts             # è®¢å•æ’®åˆå¼•æ“ï¼ˆæ¨¡æ‹Ÿå¸‚ä»·å•/æ¡ä»¶å•ï¼‰
â”‚   â”œâ”€â”€ SlippageSimulator.ts        # æ»‘ç‚¹æ¨¡æ‹Ÿå™¨ï¼ˆåŸºäºæµåŠ¨æ€§ï¼‰
â”‚   â””â”€â”€ FeeCalculator.ts            # æ‰‹ç»­è´¹è®¡ç®—å™¨ï¼ˆMaker/Takerï¼‰
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ HistoricalDataLoader.ts     # å†å²æ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ CandleCache.ts              # Kçº¿æ•°æ®ç¼“å­˜ï¼ˆæ”¯æŒå¤šæ—¶é—´æ¡†æ¶ï¼‰
â”‚   â”œâ”€â”€ OrderBookSimulator.ts       # è®¢å•ç°¿æ¨¡æ‹Ÿå™¨
â”‚   â””â”€â”€ DataValidator.ts            # æ•°æ®è´¨é‡éªŒè¯
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ PerformanceAnalyzer.ts      # ç»©æ•ˆåˆ†æå™¨
â”‚   â”œâ”€â”€ MetricsCalculator.ts        # æŒ‡æ ‡è®¡ç®—å™¨ï¼ˆå¤æ™®ã€æœ€å¤§å›æ’¤ã€èƒœç‡ç­‰ï¼‰
â”‚   â”œâ”€â”€ TradeLogger.ts              # äº¤æ˜“æ—¥å¿—åˆ†æ
â”‚   â””â”€â”€ ReportGenerator.ts          # å›æµ‹æŠ¥å‘Šç”Ÿæˆå™¨
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ BacktestConfig.ts           # å›æµ‹é…ç½®æ¥å£
â”‚   â””â”€â”€ presets.ts                  # é¢„è®¾é…ç½®ï¼ˆå¿«é€Ÿã€æ ‡å‡†ã€ç²¾ç¡®ï¼‰
â””â”€â”€ utils/
    â”œâ”€â”€ priceImpact.ts              # ä»·æ ¼å†²å‡»æ¨¡å‹
    â”œâ”€â”€ latencySimulator.ts         # å»¶è¿Ÿæ¨¡æ‹Ÿ
    â””â”€â”€ randomUtils.ts              # éšæœºæ•°å·¥å…·ï¼ˆå¯å¤ç°ï¼‰
```

---

## ğŸš€ å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€è®¾æ–½æ­å»º (Week 1-2)

#### 1.1 æ•°æ®å±‚æ„å»º âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **å†å²æ•°æ®ä¸‹è½½å™¨**
  - å®ç° Gate.io/Binance å†å² Kçº¿ä¸‹è½½
  - æ”¯æŒå¤šæ—¶é—´æ¡†æ¶ï¼ˆ5m, 15m, 1h, 4hï¼‰
  - æ”¯æŒå¢é‡æ›´æ–°ï¼ˆé¿å…é‡å¤ä¸‹è½½ï¼‰
  - æ•°æ®å­˜å‚¨æ ¼å¼ï¼šSQLite æˆ– Parquetï¼ˆé«˜æ€§èƒ½ï¼‰
  
  ```typescript
  interface HistoricalDataConfig {
    symbols: string[];            // ['BTC', 'ETH', 'SOL']
    timeframes: string[];         // ['5m', '15m', '1h', '4h']
    startDate: string;            // '2024-01-01'
    endDate: string;              // '2024-12-31'
    exchange: 'gate' | 'binance';
  }
  ```

- [ ] **æ•°æ®è´¨é‡éªŒè¯**
  - æ£€æµ‹ç¼ºå¤±æ•°æ®ï¼ˆKçº¿ç©ºç™½ï¼‰
  - æ£€æµ‹å¼‚å¸¸æ•°æ®ï¼ˆä»·æ ¼çªå˜ã€æˆäº¤é‡å¼‚å¸¸ï¼‰
  - æ•°æ®å¯¹é½æ£€æŸ¥ï¼ˆå¤šæ—¶é—´æ¡†æ¶ä¸€è‡´æ€§ï¼‰
  - ç”Ÿæˆæ•°æ®è´¨é‡æŠ¥å‘Š

- [ ] **æ•°æ®åº“ Schema æ‰©å±•**

  ```sql
  -- å†å² Kçº¿è¡¨
  CREATE TABLE backtest_candles (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL,
    timeframe TEXT NOT NULL,      -- '5m', '15m', '1h', '4h'
    timestamp INTEGER NOT NULL,   -- Unix æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
    open REAL NOT NULL,
    high REAL NOT NULL,
    low REAL NOT NULL,
    close REAL NOT NULL,
    volume REAL NOT NULL,
    quote_volume REAL,            -- æŠ¥ä»·èµ„äº§æˆäº¤é‡
    trades_count INTEGER,         -- äº¤æ˜“ç¬”æ•°
    UNIQUE(symbol, timeframe, timestamp)
  );
  CREATE INDEX idx_candles_symbol_time ON backtest_candles(symbol, timeframe, timestamp);
  
  -- è®¢å•ç°¿å¿«ç…§è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºé«˜ç²¾åº¦å›æµ‹ï¼‰
  CREATE TABLE backtest_orderbook_snapshots (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL,
    timestamp INTEGER NOT NULL,
    bids TEXT NOT NULL,           -- JSON: [[price, qty], ...]
    asks TEXT NOT NULL,           -- JSON: [[price, qty], ...]
    UNIQUE(symbol, timestamp)
  );
  ```

**äº¤ä»˜ç‰©ï¼š**

- `src/backtest/data/HistoricalDataLoader.ts`
- `scripts/download-historical-data.ts`ï¼ˆCLI å·¥å…·ï¼‰
- æ•°æ®ä¸‹è½½æ–‡æ¡£ï¼ˆ`docs/å›æµ‹æ•°æ®ä¸‹è½½æŒ‡å—.md`ï¼‰

---

#### 1.2 æ¨¡æ‹Ÿäº¤æ˜“æ‰€å®ç° âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **BacktestExchangeClient æ ¸å¿ƒæ¥å£**
  - å®ç° `IExchangeClient` æ¥å£
  - æ”¯æŒæ‰€æœ‰å¿…éœ€æ–¹æ³•ï¼ˆgetAccountInfo, getTicker, getCandles, placeOrder, etc.ï¼‰
  - å†…éƒ¨çŠ¶æ€ç®¡ç†ï¼ˆè´¦æˆ·ä½™é¢ã€æŒä»“ã€æŒ‚å•ï¼‰
  
  ```typescript
  class BacktestExchangeClient implements IExchangeClient {
    private currentTime: number;           // å½“å‰æ¨¡æ‹Ÿæ—¶é—´
    private account: BacktestAccount;      // è´¦æˆ·çŠ¶æ€
    private positions: Map<string, Position>; // æŒä»“
    private orders: Map<string, Order>;    // æŒ‚å•
    private candleCache: CandleCache;      // Kçº¿æ•°æ®ç¼“å­˜
    
    // æ ¸å¿ƒæ–¹æ³•
    async getAccountInfo(): Promise<AccountInfo>;
    async getTicker(symbol: string): Promise<TickerInfo>;
    async getCandles(params: CandleParams): Promise<Candle[]>;
    async placeOrder(params: OrderParams): Promise<Order>;
    async cancelOrder(orderId: string): Promise<void>;
    
    // å›æµ‹ä¸“ç”¨æ–¹æ³•
    advanceTime(newTime: number): void;    // æ—¶é—´å‰è¿›
    processOrders(): void;                 // å¤„ç†æŒ‚å•ï¼ˆæ­¢æŸ/æ­¢ç›ˆï¼‰
    updatePositions(): void;               // æ›´æ–°æŒä»“ç›ˆäº
  }
  ```

- [ ] **è®¢å•æ’®åˆå¼•æ“**
  - å¸‚ä»·å•ç«‹å³æˆäº¤ï¼ˆä½¿ç”¨å½“å‰ Bar çš„ Close ä»·æ ¼ï¼‰
  - é™ä»·å•æ’®åˆï¼ˆä»·æ ¼è¾¾åˆ°æ—¶æˆäº¤ï¼‰
  - æ¡ä»¶å•è§¦å‘ï¼ˆæ­¢æŸ/æ­¢ç›ˆï¼‰
  - æˆäº¤ä»·æ ¼æ¨¡æ‹Ÿï¼š
    - **ä¿å®ˆæ¨¡å¼**ï¼šä¸åˆ©ä»·æ ¼æˆäº¤ï¼ˆä¹°å…¥ç”¨ Highï¼Œå–å‡ºç”¨ Lowï¼‰
    - **æ ‡å‡†æ¨¡å¼**ï¼šClose ä»·æ ¼æˆäº¤
    - **ä¹è§‚æ¨¡å¼**ï¼šæœ‰åˆ©ä»·æ ¼æˆäº¤ï¼ˆä¹°å…¥ç”¨ Lowï¼Œå–å‡ºç”¨ Highï¼‰

- [ ] **æ»‘ç‚¹æ¨¡æ‹Ÿå™¨**

  ```typescript
  class SlippageSimulator {
    calculateSlippage(params: {
      symbol: string;
      side: 'buy' | 'sell';
      quantity: number;
      currentPrice: number;
      volume24h: number;        // 24å°æ—¶æˆäº¤é‡
      avgBarVolume: number;     // å½“å‰ Bar å¹³å‡æˆäº¤é‡
    }): number {
      // åŸºäºæµåŠ¨æ€§çš„æ»‘ç‚¹æ¨¡å‹
      const liquidityRatio = quantity / avgBarVolume;
      const baseSlippage = 0.0001; // 0.01% åŸºç¡€æ»‘ç‚¹
      const impactSlippage = liquidityRatio * 0.005; // æµåŠ¨æ€§å†²å‡»
      return baseSlippage + impactSlippage;
    }
  }
  ```

- [ ] **æ‰‹ç»­è´¹è®¡ç®—å™¨**

  ```typescript
  interface FeeConfig {
    makerRate: number;   // Maker è´¹ç‡ï¼ˆä¾‹å¦‚ 0.0002 = 0.02%ï¼‰
    takerRate: number;   // Taker è´¹ç‡ï¼ˆä¾‹å¦‚ 0.0005 = 0.05%ï¼‰
  }
  
  class FeeCalculator {
    calculateFee(params: {
      orderType: 'limit' | 'market';
      quantity: number;
      price: number;
      feeConfig: FeeConfig;
    }): number;
  }
  ```

**äº¤ä»˜ç‰©ï¼š**

- `src/backtest/exchanges/BacktestExchangeClient.ts`
- `src/backtest/exchanges/OrderMatcher.ts`
- `src/backtest/exchanges/SlippageSimulator.ts`
- `src/backtest/exchanges/FeeCalculator.ts`
- å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰

---

#### 1.3 æ—¶é—´æ¨¡æ‹Ÿå™¨ä¸äº‹ä»¶æ€»çº¿ âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **æ—¶é—´æ¨¡æ‹Ÿå™¨**

  ```typescript
  class TimeSimulator {
    private currentTime: number;
    private timeStep: number;      // æ—¶é—´æ­¥é•¿ï¼ˆæ¯«ç§’ï¼‰
    private speed: number;         // å›æµ‹é€Ÿåº¦å€æ•°
    
    advance(): void {
      this.currentTime += this.timeStep;
      this.eventBus.emit('time-tick', this.currentTime);
    }
    
    jumpTo(timestamp: number): void {
      this.currentTime = timestamp;
    }
    
    getCurrentTime(): number {
      return this.currentTime;
    }
  }
  ```

- [ ] **äº‹ä»¶æ€»çº¿**

  ```typescript
  type BacktestEvent = 
    | { type: 'time-tick'; time: number }
    | { type: 'candle-update'; symbol: string; candle: Candle }
    | { type: 'order-filled'; order: Order }
    | { type: 'order-cancelled'; orderId: string }
    | { type: 'position-opened'; position: Position }
    | { type: 'position-closed'; position: Position; pnl: number }
    | { type: 'stop-loss-triggered'; positionId: string }
    | { type: 'take-profit-triggered'; positionId: string };
  
  class EventBus {
    private listeners: Map<string, Function[]>;
    
    on(event: string, handler: Function): void;
    emit(event: string, data: any): void;
    off(event: string, handler: Function): void;
  }
  ```

**äº¤ä»˜ç‰©ï¼š**

- `src/backtest/core/TimeSimulator.ts`
- `src/backtest/core/EventBus.ts`

---

### Phase 2: å›æµ‹å¼•æ“æ ¸å¿ƒ (Week 3-4)

#### 2.1 AI å†³ç­–æ¨¡æ‹Ÿæ–¹æ¡ˆ âš¡ (æ ¸å¿ƒåˆ›æ–°)

**æ ¸å¿ƒé—®é¢˜åˆ†æï¼š**

ä½ çš„æ‹…å¿§éå¸¸æ­£ç¡®ï¼è°ƒç”¨çœŸå® AI è¿›è¡Œå›æµ‹å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼š

- âŒ **èµ„è´¹é«˜æ˜‚**ï¼šDeepSeek $0.001/1K tokensï¼ŒGPT-4 $0.03/1K tokensï¼Œ1å¹´æ•°æ®å¯èƒ½è°ƒç”¨10000+æ¬¡ï¼Œæˆæœ¬æ•°ç™¾ç¾å…ƒ
- âŒ **é€Ÿåº¦ææ…¢**ï¼šæ¯æ¬¡ AI å“åº” 2-10 ç§’ï¼Œ1å¹´å›æµ‹(æ¯15åˆ†é’Ÿä¸€æ¬¡ = 35000æ¬¡è°ƒç”¨)éœ€è¦æ•°å¤©
- âŒ **ä¸å¯å¤ç°**ï¼šAI å“åº”æœ‰éšæœºæ€§ï¼ŒåŒæ ·è¾“å…¥å¯èƒ½å¾—åˆ°ä¸åŒè¾“å‡ºï¼Œæ— æ³•åšA/Bæµ‹è¯•
- âŒ **æ— æ³•æ‰¹é‡ä¼˜åŒ–**ï¼šå‚æ•°ç½‘æ ¼æœç´¢éœ€è¦è¿è¡Œæ•°ç™¾æ¬¡ï¼Œæˆæœ¬å’Œæ—¶é—´å®Œå…¨æ— æ³•æ¥å—

è§£å†³æ–¹æ¡ˆï¼šè§„åˆ™å¼•æ“æ¨¡æ‹Ÿ AI å†³ç­–**

**æ·±åº¦åˆ†æ AI å†³ç­–é€»è¾‘ï¼ˆåŸºäº tradingAgent.tsï¼‰ï¼š**

é€šè¿‡æ·±åº¦åˆ†æå½“å‰ç³»ç»Ÿçš„ AI æç¤ºè¯ï¼ˆ2000+ è¡Œï¼‰ï¼ŒAI çš„å†³ç­–å¯ä»¥åˆ†è§£ä¸ºï¼š

- ç¬¬1å±‚ï¼šæŒä»“ç®¡ç†å†³ç­–ï¼ˆè§„åˆ™æ˜ç¡®ï¼Œ100%å¯è§„åˆ™åŒ–ï¼‰**

```typescript
// AI çš„æç¤ºè¯æ˜ç¡®è§„å®šäº†å¼ºåˆ¶æ‰§è¡Œé¡ºåºï¼š

1. æ£€æŸ¥åˆ†æ‰¹æ­¢ç›ˆæœºä¼šï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   æ¡ä»¶: currentR â‰¥ stage1/2/3 çš„ rMultiple é˜ˆå€¼
   åŠ¨ä½œ: executePartialTakeProfit(symbol, stage)
   
2. æ£€æŸ¥å³°å€¼å›æ’¤ä¿æŠ¤
   æ¡ä»¶: (peak_pnl_percent - current_pnl_percent) â‰¥ peakDrawdownProtection
   åŠ¨ä½œ: closePosition(symbol, reason='peak_drawdown')
   
3. æ£€æŸ¥è¶‹åŠ¿åè½¬
   æ¡ä»¶: 3+ä¸ªæ—¶é—´æ¡†æ¶ç¡®è®¤åè½¬ && ç½®ä¿¡åº¦ â‰¥ 70%
   åŠ¨ä½œ: closePosition(symbol, reason='trend_reversal')
   
4. æ£€æŸ¥æŒä»“æ—¶é—´é™åˆ¶
   æ¡ä»¶: holdingHours â‰¥ 36
   åŠ¨ä½œ: closePosition(symbol, reason='time_limit')
   
5. æ£€æŸ¥ç§»åŠ¨æ­¢æŸä¼˜åŒ–
   æ¡ä»¶: ç›ˆåˆ©è¾¾åˆ° trailingStop.level1/2/3.trigger
   åŠ¨ä½œ: updatePositionStopLoss(newStopLoss)
```

- ç¬¬2å±‚ï¼šæ–°å¼€ä»“å†³ç­–ï¼ˆå¼ºåˆ¶æµç¨‹ï¼Œ90%å¯è§„åˆ™åŒ–ï¼‰**

```typescript
// AI çš„æç¤ºè¯å¼ºåˆ¶è¦æ±‚ä»¥ä¸‹æµç¨‹ï¼š

æ­¥éª¤1: è°ƒç”¨ analyze_opening_opportunities()
       â†’ è¿”å›æ‰€æœ‰å¸ç§çš„æœºä¼šè¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰
       â†’ è¯„åˆ†ç®—æ³•ï¼šä¿¡å·å¼ºåº¦40% + é£é™©å›æŠ¥25% + å¸‚åœºæ¡ä»¶20% + ç›¸å…³æ€§15%

æ­¥éª¤2: ç­›é€‰è¯„åˆ† â‰¥ MIN_OPPORTUNITY_SCORE çš„æœºä¼š
       â†’ é»˜è®¤é˜ˆå€¼ï¼š70åˆ†
       â†’ AI è¢«ä¸¥æ ¼ç¦æ­¢åœ¨ < 60åˆ†æ—¶å¼€ä»“

æ­¥éª¤3: è°ƒç”¨ checkOpenPosition() éªŒè¯æ­¢æŸ
       â†’ æ£€æŸ¥æ­¢æŸè·ç¦»æ˜¯å¦åœ¨ minDistance-maxDistance èŒƒå›´å†…
       â†’ æ£€æŸ¥å¸‚åœºæ³¢åŠ¨ç‡æ˜¯å¦æ­£å¸¸
       â†’ éªŒè¯ä¸é€šè¿‡ â†’ æ‹’ç»å¼€ä»“

æ­¥éª¤4: æ‰§è¡Œ openPosition()
       â†’ ä½¿ç”¨æ­¥éª¤3è¿”å›çš„æ­¢æŸä½
       â†’ æ ¹æ®ç­–ç•¥é€‰æ‹©æ æ†ï¼ˆleverageMin-leverageMaxï¼‰
       â†’ æ ¹æ®ä¿¡å·å¼ºåº¦é€‰æ‹©ä»“ä½ï¼ˆpositionSizeMin-Maxï¼‰
```

- ç¬¬3å±‚ï¼šæœºä¼šè¯„åˆ†ç®—æ³•ï¼ˆå…³é”®ï¼Œ80%å¯è§„åˆ™åŒ–ï¼‰**

```typescript
// analyze_opening_opportunities() çš„è¯„åˆ†é€»è¾‘ï¼š

interface OpportunityScoring {
  // ç»´åº¦1: ä¿¡å·å¼ºåº¦ï¼ˆ40%æƒé‡ï¼‰
  signalStrength: {
    è¶‹åŠ¿ä¸€è‡´æ€§: 0-30åˆ†,  // å¤šæ—¶é—´æ¡†æ¶EMAå…³ç³»ä¸€è‡´æ€§
    åŠ¨é‡æŒ‡æ ‡: 0-30åˆ†,    // MACDæ–¹å‘ + RSIä½ç½®
    è¶…ä¹°è¶…å–: 0-20åˆ†,    // è¶…å–åšå¤š/è¶…ä¹°åšç©ºåŠ åˆ†
    å½¢æ€æ¸…æ™°åº¦: 0-20åˆ†   // ä»·æ ¼ç›¸å¯¹EMA20/50ä½ç½®
  },
  
  // ç»´åº¦2: é£é™©å›æŠ¥ï¼ˆ25%æƒé‡ï¼‰
  riskReward: {
    æ­¢æŸè·ç¦»: ATR * atrMultiplier,
    ç›®æ ‡æ”¶ç›Š: æ­¢æŸè·ç¦» * 3,  // å‡è®¾3Rç›®æ ‡
    é£é™©å›æŠ¥æ¯”: ç›®æ ‡/æ­¢æŸ
    // è¯„åˆ†: 2R=60åˆ†, 3R=80åˆ†, 4R+=100åˆ†
  },
  
  // ç»´åº¦3: å¸‚åœºæ¡ä»¶ï¼ˆ20%æƒé‡ï¼‰
  marketCondition: {
    æµåŠ¨æ€§: å½“å‰æˆäº¤é‡ / å¹³å‡æˆäº¤é‡,  // è¶Šé«˜è¶Šå¥½
    æ³¢åŠ¨ç‡: ATRå ä»·æ ¼ç™¾åˆ†æ¯”,         // ç†æƒ³ï¼š1-5%
    æ—¶æ®µ: äº¤æ˜“æ´»è·ƒåº¦
  },
  
  // ç»´åº¦4: æŒä»“ç›¸å…³æ€§ï¼ˆ15%æƒé‡ï¼‰
  correlationScore: {
    // ç®€åŒ–å¤„ç†ï¼šæ£€æŸ¥æ˜¯å¦å·²æŒæœ‰åŒæ¿å—å¸ç§
    // ä¾‹å¦‚ï¼šå·²æŒæœ‰BTCï¼Œå†å¼€ETHæ‰£åˆ†
  }
}

// æœ€ç»ˆè¯„åˆ† = signalStrength*0.4 + riskReward*0.25 + marketCondition*0.2 + correlation*0.15
```

**å…³é”®å‘ç°ï¼šAI å†³ç­– 85% å¯è§„åˆ™åŒ–ï¼**

AI çš„æç¤ºè¯å·²ç»å®šä¹‰äº†éå¸¸æ˜ç¡®çš„å†³ç­–æµç¨‹ï¼Œåªæœ‰15%çš„"è½¯åˆ¤æ–­"éœ€è¦AIï¼š

- âœ… **å¯è§„åˆ™åŒ–**ï¼ˆ85%ï¼‰ï¼šæŒä»“ç®¡ç†ã€æœºä¼šç­›é€‰ã€è¯„åˆ†è®¡ç®—ã€æ­¢æŸéªŒè¯
- âš ï¸ **éœ€è¦AI**ï¼ˆ10%ï¼‰ï¼šæç«¯å¸‚åœºæƒ…å†µçš„åˆ¤æ–­ï¼ˆå¦‚çªå‘æ–°é—»ã€å¼‚å¸¸æ³¢åŠ¨ï¼‰
- âš ï¸ **éœ€è¦AI**ï¼ˆ5%ï¼‰ï¼šç­–ç•¥å‚æ•°çš„å¾®è°ƒï¼ˆå¦‚ä¿¡å·å¼ºåº¦çš„ä¸»è§‚åˆ¤æ–­ï¼‰

å®æ–½æ–¹æ¡ˆï¼šè§„åˆ™å¼•æ“ + å¯é€‰AIæ··åˆæ¨¡å¼**

```typescript
// src/backtest/decision/RuleBasedDecisionEngine.ts

/**
 * åŸºäºè§„åˆ™çš„å†³ç­–å¼•æ“ï¼ˆæ¨¡æ‹ŸAIå†³ç­–ï¼‰
 * ç›®æ ‡ï¼šåœ¨å›æµ‹ä¸­ä»¥ <1ms/å†³ç­–ã€$0æˆæœ¬ å¤ç° AI çš„å†³ç­–é€»è¾‘
 */
class RuleBasedDecisionEngine {
  private strategyParams: StrategyParams;
  private minOpportunityScore: number;
  
  /**
   * æ‰§è¡Œäº¤æ˜“å‘¨æœŸå†³ç­–ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
   * è¾“å…¥ï¼šä¸ AI ç›¸åŒçš„ä¸Šä¸‹æ–‡
   * è¾“å‡ºï¼šå†³ç­–ç»“æœ
   * æ€§èƒ½ï¼š<1msï¼ˆvs AIçš„2-10ç§’ï¼‰
   */
  async executeTradingCycle(context: TradingContext): Promise<DecisionResult> {
    const decisions: Decision[] = [];
    
    // ===== ç¬¬1å±‚ï¼šæŒä»“ç®¡ç†ï¼ˆ100%è§„åˆ™åŒ–ï¼‰=====
    for (const position of context.positions) {
      // 1. åˆ†æ‰¹æ­¢ç›ˆæ£€æŸ¥
      const rMultiple = this.calculateRMultiple(position);
      const stage = this.getPartialTakeProfitStage(rMultiple);
      if (stage) {
        decisions.push({ action: 'partial_take_profit', symbol: position.symbol, stage });
        continue;
      }
      
      // 2. å³°å€¼å›æ’¤æ£€æŸ¥
      const drawdown = position.peak_pnl_percent - position.unrealized_pnl_percent;
      if (drawdown >= this.strategyParams.peakDrawdownProtection) {
        decisions.push({ action: 'close', symbol: position.symbol, reason: 'peak_drawdown' });
        continue;
      }
      
      // 3. è¶‹åŠ¿åè½¬æ£€æŸ¥
      const reversal = this.detectTrendReversal(position, context.marketStates);
      if (reversal.timeframes >= 3 && reversal.confidence >= 70) {
        decisions.push({ action: 'close', symbol: position.symbol, reason: 'trend_reversal' });
        continue;
      }
      
      // 4. æ—¶é—´é™åˆ¶æ£€æŸ¥
      if (this.getHoldingHours(position) >= 36) {
        decisions.push({ action: 'close', symbol: position.symbol, reason: 'time_limit' });
        continue;
      }
      
      // 5. ç§»åŠ¨æ­¢æŸä¼˜åŒ–
      const trailingStop = this.checkTrailingStop(position);
      if (trailingStop.shouldUpdate) {
        decisions.push({ action: 'update_stop_loss', symbol: position.symbol, newStopLoss: trailingStop.newStopLoss });
      }
    }
    
    // ===== ç¬¬2å±‚ï¼šæ–°å¼€ä»“è¯„ä¼°ï¼ˆ90%è§„åˆ™åŒ–ï¼‰=====
    if (context.positions.length >= RISK_PARAMS.MAX_POSITIONS) {
      return { decisions, reason: 'å·²è¾¾æœ€å¤§æŒä»“æ•°' };
    }
    
    // æ­¥éª¤1: åˆ†ææ‰€æœ‰å¸ç§çš„å¼€ä»“æœºä¼š
    const opportunities = this.analyzeAllOpportunities(context);
    
    // æ­¥éª¤2: ç­›é€‰åˆæ ¼æœºä¼š
    const qualified = opportunities.filter(opp => opp.score >= this.minOpportunityScore);
    if (qualified.length === 0) {
      return { decisions, reason: `æ— è¯„åˆ†â‰¥${this.minOpportunityScore}çš„æœºä¼š` };
    }
    
    // æ­¥éª¤3: é€‰æ‹©æœ€ä½³æœºä¼š
    const best = qualified[0];
    
    // æ­¥éª¤4: éªŒè¯æ­¢æŸåˆç†æ€§
    const stopLossCheck = this.validateStopLoss(best, context);
    if (!stopLossCheck.shouldOpen) {
      return { decisions, reason: 'æ­¢æŸéªŒè¯æœªé€šè¿‡' };
    }
    
    // æ­¥éª¤5: ç”Ÿæˆå¼€ä»“å†³ç­–
    decisions.push({
      action: 'open',
      symbol: best.symbol,
      side: best.side,
      leverage: this.calculateLeverage(best),
      positionSize: this.calculatePositionSize(best),
      stopLoss: stopLossCheck.stopLossPrice,
      reason: `${best.strategyType}ç­–ç•¥ï¼Œè¯„åˆ†${best.score}`
    });
    
    return { decisions };
  }
  
  /**
   * åˆ†ææ‰€æœ‰å¸ç§çš„å¼€ä»“æœºä¼šï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰
   * å¤ç° analyze_opening_opportunities å·¥å…·çš„é€»è¾‘
   */
  private analyzeAllOpportunities(context: TradingContext): Opportunity[] {
    const opportunities: Opportunity[] = [];
    const heldSymbols = new Set(context.positions.map(p => p.symbol));
    
    for (const symbol of RISK_PARAMS.TRADING_SYMBOLS) {
      if (heldSymbols.has(symbol)) continue;
      
      const marketData = context.marketData[symbol];
      const marketState = context.marketStates.get(symbol);
      if (!marketData || !marketState) continue;
      
      // åˆ†æåšå¤šæœºä¼š
      const longOpp = this.evaluateLongOpportunity(symbol, marketData, marketState, context);
      if (longOpp) opportunities.push(longOpp);
      
      // åˆ†æåšç©ºæœºä¼š
      const shortOpp = this.evaluateShortOpportunity(symbol, marketData, marketState, context);
      if (shortOpp) opportunities.push(shortOpp);
    }
    
    // æŒ‰è¯„åˆ†é™åºæ’åº
    return opportunities.sort((a, b) => b.score - a.score);
  }
  
  /**
   * è¯„ä¼°åšå¤šæœºä¼šï¼ˆå¤ç°AIçš„åšå¤šä¿¡å·è¯†åˆ«ï¼‰
   */
  private evaluateLongOpportunity(
    symbol: string,
    marketData: any,
    marketState: MarketStateAnalysis,
    context: TradingContext
  ): Opportunity | null {
    // 1. æ ¹æ®å¸‚åœºçŠ¶æ€é€‰æ‹©ç­–ç•¥
    let strategyType: StrategyType;
    let baseScore = 0;
    
    switch (marketState.state) {
      case 'uptrend_oversold':
        strategyType = 'mean_reversion';
        baseScore = 90;  // æœ€é«˜ä¼˜å…ˆçº§
        break;
      case 'uptrend_continuation':
        strategyType = 'trend_following';
        baseScore = 80;
        break;
      case 'ranging_oversold':
        strategyType = 'mean_reversion';
        baseScore = 70;
        break;
      default:
        return null;  // ä¸é€‚åˆåšå¤š
    }
    
    // 2. è®¡ç®—å››ç»´è¯„åˆ†
    const signalStrength = this.calculateSignalStrength(marketData, marketState, 'long');
    const riskReward = this.calculateRiskReward(marketData, 'long', context);
    const marketCondition = this.calculateMarketCondition(marketData);
    const correlation = this.calculateCorrelation(symbol, context);
    
    // 3. åŠ æƒè®¡ç®—æœ€ç»ˆè¯„åˆ†
    const finalScore = baseScore * (
      signalStrength * 0.40 +
      riskReward * 0.25 +
      marketCondition * 0.20 +
      correlation * 0.15
    );
    
    return {
      symbol,
      side: 'long',
      strategyType,
      score: Math.round(finalScore),
      breakdown: { signalStrength, riskReward, marketCondition, correlation },
      marketState: marketState.state
    };
  }
  
  /**
   * è®¡ç®—ä¿¡å·å¼ºåº¦ï¼ˆ40%æƒé‡ï¼Œæ»¡åˆ†100ï¼‰
   */
  private calculateSignalStrength(
    marketData: any,
    marketState: MarketStateAnalysis,
    side: 'long' | 'short'
  ): number {
    let score = 0;
    
    // å­ç»´åº¦1: è¶‹åŠ¿ä¸€è‡´æ€§ï¼ˆ0-30åˆ†ï¼‰
    const alignmentScore = marketState.timeframeAlignment.alignmentScore;
    score += alignmentScore * 30;
    
    // å­ç»´åº¦2: åŠ¨é‡æŒ‡æ ‡ï¼ˆ0-30åˆ†ï¼‰
    if (side === 'long') {
      score += (marketData.macd > 0 ? 15 : 0);  // MACDæ­£å€¼
      score += (marketData.rsi7 > 50 && marketData.rsi7 < 70 ? 15 : 0);  // RSIå¥åº·åŒºé—´
    } else {
      score += (marketData.macd < 0 ? 15 : 0);
      score += (marketData.rsi7 < 50 && marketData.rsi7 > 30 ? 15 : 0);
    }
    
    // å­ç»´åº¦3: è¶…ä¹°è¶…å–ï¼ˆ0-20åˆ†ï¼‰
    if (marketState.state.includes('oversold') && side === 'long') {
      score += 20;  // è¶…å–åå¼¹
    } else if (marketState.state.includes('overbought') && side === 'short') {
      score += 20;  // è¶…ä¹°å›è½
    }
    
    // å­ç»´åº¦4: å½¢æ€æ¸…æ™°åº¦ï¼ˆ0-20åˆ†ï¼‰
    const emaRelation = side === 'long'
      ? (marketData.price > marketData.ema20 ? 10 : 0) + (marketData.ema20 > marketData.ema50 ? 10 : 0)
      : (marketData.price < marketData.ema20 ? 10 : 0) + (marketData.ema20 < marketData.ema50 ? 10 : 0);
    score += emaRelation;
    
    return score / 100;  // å½’ä¸€åŒ–åˆ° 0-1
  }
  
  /**
   * è®¡ç®—é£é™©å›æŠ¥æ¯”ï¼ˆ25%æƒé‡ï¼Œæ»¡åˆ†100ï¼‰
   */
  private calculateRiskReward(
    marketData: any,
    side: 'long' | 'short',
    context: TradingContext
  ): number {
    // è·å–ATRï¼ˆç”¨äºæ­¢æŸè®¡ç®—ï¼‰
    const atr = marketData.longerTermContext?.atr14 || (marketData.price * 0.02);
    
    // è®¡ç®—æ­¢æŸè·ç¦»
    const atrMultiplier = this.strategyParams.scientificStopLoss?.atrMultiplier || 2.0;
    const stopLossDistance = atr * atrMultiplier;
    
    // ä¼°ç®—ç›®æ ‡æ”¶ç›Šï¼ˆå‡è®¾3Rï¼‰
    const targetProfit = stopLossDistance * 3;
    
    // é£é™©å›æŠ¥æ¯”
    const riskRewardRatio = targetProfit / stopLossDistance;  // = 3
    
    // è¯„åˆ†è§„åˆ™ï¼š2R=60, 3R=80, 4R+=100
    if (riskRewardRatio >= 4) return 1.0;
    if (riskRewardRatio >= 3) return 0.8;
    if (riskRewardRatio >= 2) return 0.6;
    return 0.4;
  }
  
  /**
   * è®¡ç®—å¸‚åœºæ¡ä»¶ï¼ˆ20%æƒé‡ï¼Œæ»¡åˆ†100ï¼‰
   */
  private calculateMarketCondition(marketData: any): number {
    let score = 0;
    
    // å­ç»´åº¦1: æµåŠ¨æ€§ï¼ˆ0-50åˆ†ï¼‰
    const volumeRatio = marketData.longerTermContext?.currentVolume / 
                        marketData.longerTermContext?.avgVolume || 1;
    score += Math.min(volumeRatio / 2, 1) * 50;  // æˆäº¤é‡2å€=æ»¡åˆ†
    
    // å­ç»´åº¦2: æ³¢åŠ¨ç‡ï¼ˆ0-50åˆ†ï¼‰
    const atrPercent = (marketData.longerTermContext?.atr14 / marketData.price) * 100;
    if (atrPercent >= 1 && atrPercent <= 5) {
      score += 50;  // ç†æƒ³æ³¢åŠ¨ç‡
    } else if (atrPercent < 1) {
      score += 30;  // è¿‡ä½
    } else if (atrPercent <= 8) {
      score += 20;  // è¿‡é«˜ä½†å¯æ¥å—
    } else {
      score += 0;   // æç«¯é«˜æ³¢åŠ¨
    }
    
    return score / 100;
  }
  
  /**
   * è®¡ç®—ç›¸å…³æ€§ï¼ˆ15%æƒé‡ï¼Œæ»¡åˆ†100ï¼‰
   */
  private calculateCorrelation(symbol: string, context: TradingContext): number {
    // ç®€åŒ–å®ç°ï¼šæ£€æŸ¥æ˜¯å¦å·²æŒæœ‰ç›¸å…³å¸ç§
    // å®Œæ•´å®ç°ï¼šè®¡ç®—ä»·æ ¼ç›¸å…³ç³»æ•°
    
    // å®šä¹‰å¸ç§æ¿å—
    const sectors = {
      'BTC': ['BTC'],
      'ETH_LAYER1': ['ETH', 'SOL', 'ADA', 'AVAX'],
      'MEME': ['DOGE', 'SHIB'],
      'DEFI': ['UNI', 'AAVE', 'LINK']
    };
    
    // æŸ¥æ‰¾å½“å‰å¸ç§æ‰€å±æ¿å—
    let currentSector = 'OTHER';
    for (const [sector, symbols] of Object.entries(sectors)) {
      if (symbols.includes(symbol)) {
        currentSector = sector;
        break;
      }
    }
    
    // æ£€æŸ¥æ˜¯å¦å·²æŒæœ‰åŒæ¿å—å¸ç§
    for (const pos of context.positions) {
      for (const [sector, symbols] of Object.entries(sectors)) {
        if (symbols.includes(pos.symbol) && sector === currentSector && symbol !== pos.symbol) {
          return 0.5;  // åŒæ¿å—å·²æŒä»“ï¼Œæ‰£50%
        }
      }
    }
    
    return 1.0;  // æ— ç›¸å…³æ€§é—®é¢˜
  }
}
```

å®æ–½æ–¹æ¡ˆï¼šä¸‰ç§æ¨¡å¼æ”¯æŒ**

```typescript
// src/backtest/config/BacktestConfig.ts

interface BacktestConfig {
  // ...existing config...
  
  // å†³ç­–æ¨¡å¼é€‰æ‹©ï¼ˆæ ¸å¿ƒé…ç½®ï¼‰
  decisionMode: 'rule-based' | 'ai-powered' | 'hybrid';
  
  // AI æ¨¡å¼é…ç½®ï¼ˆä»…åœ¨ ai-powered/hybrid æ—¶ä½¿ç”¨ï¼‰
  aiConfig?: {
    provider: 'openrouter' | 'openai' | 'deepseek';
    model: string;
    apiKey: string;
    maxCalls?: number;      // æˆæœ¬æ§åˆ¶ï¼šæœ€å¤§è°ƒç”¨æ¬¡æ•°
    samplingRate?: number;  // é‡‡æ ·ç‡ï¼šæ¯Nä¸ªå‘¨æœŸè°ƒç”¨ä¸€æ¬¡AIï¼ˆå…¶ä½™ç”¨è§„åˆ™ï¼‰
  };
}

// ä½¿ç”¨ç¤ºä¾‹ï¼š
const config: BacktestConfig = {
  decisionMode: 'rule-based',  // é»˜è®¤ï¼šçº¯è§„åˆ™å¼•æ“ï¼ˆé€Ÿåº¦æœ€å¿«ï¼Œæˆæœ¬ä¸º0ï¼‰
  // decisionMode: 'ai-powered',  // å¯é€‰ï¼šçº¯AIå†³ç­–ï¼ˆæœ€å‡†ç¡®ï¼Œä½†æ…¢ä¸”è´µï¼‰
  // decisionMode: 'hybrid',      // å¯é€‰ï¼šæ··åˆæ¨¡å¼ï¼ˆå…³é”®å†³ç­–ç”¨AIï¼Œå¸¸è§„ç”¨è§„åˆ™ï¼‰
};
```

**æ€§èƒ½å¯¹æ¯”ï¼š**

| æ¨¡å¼ | é€Ÿåº¦ | æˆæœ¬ï¼ˆ1å¹´å›æµ‹ï¼‰ | å‡†ç¡®åº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|----------------|--------|---------|
| **rule-based** | âš¡ 0.5ms/å†³ç­– | **$0** | 85-90% | æ—¥å¸¸å›æµ‹ã€å‚æ•°ä¼˜åŒ– |
| **hybrid** | ğŸš€ 50ms/å†³ç­– | $5-20 | 95-98% | æœ€ç»ˆéªŒè¯ã€å…³é”®å†³ç­– |
| **ai-powered** | ğŸŒ 5s/å†³ç­– | $200-500 | 100% | ç ”ç©¶ã€å¯¹æ¯”åŸºå‡† |

**äº¤ä»˜ç‰©æ›´æ–°ï¼š**

- [ ] `src/backtest/decision/RuleBasedDecisionEngine.ts`ï¼ˆæ ¸å¿ƒï¼‰
- [ ] `src/backtest/decision/AIDecisionEngine.ts`ï¼ˆå¯é€‰ï¼‰
- [ ] `src/backtest/decision/HybridDecisionEngine.ts`ï¼ˆå¯é€‰ï¼‰
- [ ] `src/backtest/decision/OpportunityScorer.ts`ï¼ˆè¯„åˆ†ç®—æ³•ï¼‰
- [ ] `src/backtest/decision/SignalAnalyzer.ts`ï¼ˆä¿¡å·åˆ†æï¼‰
- [ ] å•å…ƒæµ‹è¯•ï¼ˆå¯¹æ¯”AIå†³ç­–ç»“æœï¼ŒéªŒè¯è§„åˆ™å¼•æ“å‡†ç¡®åº¦ï¼‰

---

#### 2.2 å›æµ‹å¼•æ“ä¸»å¾ªç¯ âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **BacktestEngine å®ç°**

  ```typescript
  class BacktestEngine {
    private config: BacktestConfig;
    private exchange: BacktestExchangeClient;
    private timeSimulator: TimeSimulator;
    private eventBus: EventBus;
    private tradingAgent: Agent;           // å¤ç”¨ç”Ÿäº§ç¯å¢ƒ Agent
    private performanceTracker: PerformanceTracker;
    
    async run(): Promise<BacktestResult> {
      // 1. åˆå§‹åŒ–
      await this.initialize();
      
      // 2. ä¸»å¾ªç¯ï¼ˆé€ Bar å›æ”¾ï¼‰
      while (this.hasMoreData()) {
        const currentBar = this.getNextBar();
        
        // 2.1 æ›´æ–°æ¨¡æ‹Ÿäº¤æ˜“æ‰€çŠ¶æ€
        this.exchange.advanceTime(currentBar.timestamp);
        this.exchange.updatePositions();
        this.exchange.processOrders();  // å¤„ç†æ­¢æŸ/æ­¢ç›ˆ
        
        // 2.2 è·å–å¤šæ—¶é—´æ¡†æ¶æ•°æ®ï¼ˆä¸å®ç›˜ç›¸åŒï¼‰
        const marketData = await this.prepareMarketData(currentBar);
        
        // 2.3 è°ƒç”¨ AI Agent å†³ç­–ï¼ˆä¸å®ç›˜ç›¸åŒï¼‰
        if (this.shouldMakeDecision(currentBar)) {
          await this.executeTradingCycle(marketData);
        }
        
        // 2.4 è®°å½•ç»©æ•ˆ
        this.performanceTracker.recordSnapshot({
          time: currentBar.timestamp,
          equity: this.exchange.getAccountInfo().totalValue,
          positions: this.exchange.getPositions()
        });
        
        // 2.5 æ£€æŸ¥é£æ§ï¼ˆè´¦æˆ·æ­¢æŸ/æ­¢ç›ˆï¼‰
        this.checkRiskLimits();
      }
      
      // 3. ç”ŸæˆæŠ¥å‘Š
      return this.generateReport();
    }
    
    private async executeTradingCycle(marketData: MarketData): Promise<void> {
      // æ„å»ºä¸å®ç›˜ç›¸åŒçš„ Prompt
      const prompt = generateTradingPrompt({
        marketData,
        positions: await this.exchange.getPositions(),
        accountInfo: await this.exchange.getAccountInfo(),
        recentTrades: await this.getRecentTrades()
      });
      
      // è°ƒç”¨çœŸå®çš„ AI Agent
      const result = await this.tradingAgent.run(prompt);
      
      // è®°å½•å†³ç­–
      await this.logDecision(result);
    }
  }
  ```

- [ ] **å›æµ‹é…ç½®æ¥å£**

  ```typescript
  interface BacktestConfig {
    // æ—¶é—´èŒƒå›´
    startDate: string;             // '2024-01-01'
    endDate: string;               // '2024-12-31'
    
    // äº¤æ˜“é…ç½®
    symbols: string[];             // ['BTC', 'ETH', 'SOL']
    strategy: string;              // 'balanced', 'aggressive', etc.
    tradingInterval: number;       // 5 (åˆ†é’Ÿ)
    
    // åˆå§‹èµ„é‡‘
    initialBalance: number;        // 1000 USDT
    
    // é£æ§é…ç½®
    maxPositions: number;          // 5
    maxLeverage: number;           // 15
    accountStopLoss: number;       // 50 USDT
    accountTakeProfit: number;     // 10000 USDT
    
    // å›æµ‹ç²¾åº¦
    precision: 'fast' | 'standard' | 'accurate';
    slippageModel: 'conservative' | 'standard' | 'optimistic';
    enableOrderBookSimulation: boolean;  // æ˜¯å¦ä½¿ç”¨è®¢å•ç°¿æ•°æ®
    
    // éšæœºç§å­ï¼ˆç¡®ä¿å¯å¤ç°ï¼‰
    randomSeed?: number;
    
    // AI é…ç½®
    aiModel: string;               // 'deepseek-v3.2-exp'
    aiProvider: string;            // 'openrouter'
  }
  ```

**äº¤ä»˜ç‰©ï¼š**

- `src/backtest/core/BacktestEngine.ts`
- `src/backtest/config/BacktestConfig.ts`
- `src/backtest/config/presets.ts`ï¼ˆé¢„è®¾é…ç½®ï¼‰

---

#### 2.2 ç»©æ•ˆè¿½è¸ªä¸åˆ†æ âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **PerformanceTracker**

  ```typescript
  class PerformanceTracker {
    private snapshots: EquitySnapshot[] = [];
    private trades: BacktestTrade[] = [];
    
    recordSnapshot(snapshot: EquitySnapshot): void;
    recordTrade(trade: BacktestTrade): void;
    
    // è®¡ç®—å…³é”®æŒ‡æ ‡
    calculateMetrics(): BacktestMetrics {
      return {
        // æ”¶ç›ŠæŒ‡æ ‡
        totalReturn: this.calculateTotalReturn(),
        annualizedReturn: this.calculateAnnualizedReturn(),
        
        // é£é™©æŒ‡æ ‡
        sharpeRatio: this.calculateSharpeRatio(),
        sortinoRatio: this.calculateSortinoRatio(),
        maxDrawdown: this.calculateMaxDrawdown(),
        maxDrawdownDuration: this.calculateMaxDrawdownDuration(),
        
        // äº¤æ˜“æŒ‡æ ‡
        totalTrades: this.trades.length,
        winRate: this.calculateWinRate(),
        profitFactor: this.calculateProfitFactor(),
        avgWin: this.calculateAvgWin(),
        avgLoss: this.calculateAvgLoss(),
        avgRMultiple: this.calculateAvgRMultiple(),
        
        // æŒä»“æŒ‡æ ‡
        avgHoldingTime: this.calculateAvgHoldingTime(),
        maxConsecutiveWins: this.calculateMaxConsecutiveWins(),
        maxConsecutiveLosses: this.calculateMaxConsecutiveLosses(),
        
        // æ‰‹ç»­è´¹
        totalFees: this.calculateTotalFees(),
        feesPercent: this.calculateFeesPercent(),
      };
    }
  }
  ```

- [ ] **MetricsCalculator**ï¼ˆè¯¦ç»†è®¡ç®—é€»è¾‘ï¼‰
  - å¤æ™®æ¯”ç‡ï¼ˆSharpe Ratioï¼‰
  - ç´¢æè¯ºæ¯”ç‡ï¼ˆSortino Ratioï¼‰
  - å¡ç›æ¯”ç‡ï¼ˆCalmar Ratioï¼‰
  - æœ€å¤§å›æ’¤ï¼ˆMax Drawdownï¼‰
  - èƒœç‡ï¼ˆWin Rateï¼‰
  - ç›ˆåˆ©å› å­ï¼ˆProfit Factorï¼‰
  - R-Multiple åˆ†å¸ƒ

**äº¤ä»˜ç‰©ï¼š**

- `src/backtest/analysis/PerformanceTracker.ts`
- `src/backtest/analysis/MetricsCalculator.ts`

---

### Phase 3: æŠ¥å‘Šä¸å¯è§†åŒ– (Week 5-6)

#### 3.1 å›æµ‹æŠ¥å‘Šç”Ÿæˆå™¨ âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **HTML æŠ¥å‘Šç”Ÿæˆ**

  ```typescript
  class ReportGenerator {
    generateHTML(result: BacktestResult): string {
      return `
        <!DOCTYPE html>
        <html>
        <head>
          <title>å›æµ‹æŠ¥å‘Š - ${result.config.symbols.join(', ')}</title>
          <style>/* æŠ¥å‘Šæ ·å¼ */</style>
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        </head>
        <body>
          <!-- 1. æ¦‚è§ˆ -->
          <section id="overview">
            <h1>å›æµ‹æ¦‚è§ˆ</h1>
            <div class="metrics-grid">
              <div>æ€»æ”¶ç›Š: ${result.metrics.totalReturn}</div>
              <div>å¤æ™®æ¯”ç‡: ${result.metrics.sharpeRatio}</div>
              <div>æœ€å¤§å›æ’¤: ${result.metrics.maxDrawdown}</div>
              <div>èƒœç‡: ${result.metrics.winRate}</div>
            </div>
          </section>
          
          <!-- 2. èµ„é‡‘æ›²çº¿ -->
          <section id="equity-curve">
            <h2>èµ„é‡‘æ›²çº¿</h2>
            <canvas id="equityChart"></canvas>
          </section>
          
          <!-- 3. å›æ’¤åˆ†æ -->
          <section id="drawdown">
            <h2>å›æ’¤åˆ†æ</h2>
            <canvas id="drawdownChart"></canvas>
          </section>
          
          <!-- 4. äº¤æ˜“æ˜ç»† -->
          <section id="trades">
            <h2>äº¤æ˜“æ˜ç»†</h2>
            <table id="tradesTable"><!-- äº¤æ˜“åˆ—è¡¨ --></table>
          </section>
          
          <!-- 5. R-Multiple åˆ†å¸ƒ -->
          <section id="r-distribution">
            <h2>R-Multiple åˆ†å¸ƒ</h2>
            <canvas id="rDistributionChart"></canvas>
          </section>
          
          <!-- 6. AI å†³ç­–åˆ†æ -->
          <section id="ai-decisions">
            <h2>AI å†³ç­–è´¨é‡åˆ†æ</h2>
            <div>å¼€ä»“ä¿¡å·å‡†ç¡®ç‡: XX%</div>
            <div>å¹³ä»“æ—¶æœºåˆç†æ€§: XX%</div>
          </section>
        </body>
        </html>
      `;
    }
  }
  ```

- [ ] **Markdown æŠ¥å‘Šç”Ÿæˆ**ï¼ˆä¾¿äºä¿å­˜å’Œåˆ†äº«ï¼‰

  ```markdown
  # å›æµ‹æŠ¥å‘Š
  
  ## é…ç½®
  - æ—¶é—´èŒƒå›´: 2024-01-01 ~ 2024-12-31
  - äº¤æ˜“å¸ç§: BTC, ETH, SOL
  - ç­–ç•¥: balanced
  - åˆå§‹èµ„é‡‘: 1000 USDT
  
  ## å…³é”®æŒ‡æ ‡
  | æŒ‡æ ‡ | æ•°å€¼ |
  |------|------|
  | æ€»æ”¶ç›Šç‡ | +45.23% |
  | å¹´åŒ–æ”¶ç›Šç‡ | +52.8% |
  | å¤æ™®æ¯”ç‡ | 1.85 |
  | æœ€å¤§å›æ’¤ | -12.5% |
  | èƒœç‡ | 58.3% |
  | ç›ˆåˆ©å› å­ | 2.1 |
  | æ€»äº¤æ˜“æ¬¡æ•° | 87 |
  | å¹³å‡ R å€æ•° | 1.8R |
  
  ## äº¤æ˜“åˆ†æ
  - æœ€ä½³äº¤æ˜“: BTC å¤šå• +8.5R (2024-03-15)
  - æœ€å·®äº¤æ˜“: ETH ç©ºå• -1.2R (2024-07-22)
  - æœ€é•¿è¿èƒœ: 7 ç¬”
  - æœ€é•¿è¿äº: 4 ç¬”
  ```

- [ ] **JSON ç»“æœå¯¼å‡º**ï¼ˆç”¨äºåç»­åˆ†æï¼‰

  ```json
  {
    "config": { /* å›æµ‹é…ç½® */ },
    "metrics": { /* ç»©æ•ˆæŒ‡æ ‡ */ },
    "trades": [ /* äº¤æ˜“åˆ—è¡¨ */ ],
    "equityCurve": [ /* èµ„é‡‘æ›²çº¿æ•°æ®ç‚¹ */ ],
    "decisions": [ /* AI å†³ç­–æ—¥å¿— */ ]
  }
  ```

**äº¤ä»˜ç‰©ï¼š**

- `src/backtest/analysis/ReportGenerator.ts`
- `public/backtest-report-template.html`
- ç¤ºä¾‹æŠ¥å‘Šï¼ˆ`docs/å›æµ‹æŠ¥å‘Šç¤ºä¾‹.html`ï¼‰

---

#### 3.2 å¯¹æ¯”åˆ†æå·¥å…· âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **å¤šç­–ç•¥å¯¹æ¯”**
  - åŒæ—¶è¿è¡Œå¤šä¸ªç­–ç•¥é…ç½®
  - ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Šï¼ˆæ”¶ç›Šã€é£é™©ã€äº¤æ˜“é¢‘ç‡ï¼‰
  - è¯†åˆ«æœ€ä¼˜ç­–ç•¥ç»„åˆ

- [ ] **å‚æ•°æ•æ„Ÿæ€§åˆ†æ**
  - ç½‘æ ¼æœç´¢å…³é”®å‚æ•°ï¼ˆæ æ†ã€æ­¢æŸè·ç¦»ã€æœºä¼šè¯„åˆ†é˜ˆå€¼ï¼‰
  - ç”Ÿæˆçƒ­åŠ›å›¾ï¼ˆå‚æ•° vs æ”¶ç›Šï¼‰
  - è¯†åˆ«ç¨³å¥å‚æ•°åŒºé—´

- [ ] **æ—¶é—´æ®µåˆ†æ**
  - æŒ‰æœˆ/å­£åº¦/å¹´æ‹†åˆ†ç»©æ•ˆ
  - è¯†åˆ«ç­–ç•¥åœ¨ä¸åŒå¸‚åœºç¯å¢ƒçš„è¡¨ç°
  - å‘ç°ç­–ç•¥é€€åŒ–æœŸ

**äº¤ä»˜ç‰©ï¼š**

- `src/backtest/analysis/ComparisonTool.ts`
- `scripts/run-strategy-comparison.ts`
- `scripts/parameter-sensitivity-analysis.ts`

---

### Phase 4: CLI å·¥å…·ä¸é›†æˆ (Week 7)

#### 4.1 å‘½ä»¤è¡Œå·¥å…· âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **å›æµ‹å‘½ä»¤**

  ```bash
  # å¿«é€Ÿå›æµ‹ï¼ˆä½¿ç”¨é¢„è®¾ï¼‰
  npm run backtest -- --preset fast --symbols BTC,ETH --start 2024-01-01 --end 2024-12-31
  
  # å®Œæ•´å›æµ‹ï¼ˆæŒ‡å®šæ‰€æœ‰å‚æ•°ï¼‰
  npm run backtest -- \
    --symbols BTC,ETH,SOL \
    --strategy balanced \
    --start 2024-01-01 \
    --end 2024-12-31 \
    --initial-balance 1000 \
    --precision standard \
    --output ./backtest-results/run-001
  
  # ç­–ç•¥å¯¹æ¯”
  npm run backtest:compare -- \
    --strategies balanced,aggressive,conservative \
    --symbols BTC,ETH \
    --start 2024-01-01 \
    --end 2024-12-31
  
  # å‚æ•°ä¼˜åŒ–
  npm run backtest:optimize -- \
    --parameter max_leverage \
    --range 5-20 \
    --step 5 \
    --symbols BTC \
    --start 2024-01-01 \
    --end 2024-12-31
  ```

- [ ] **æ•°æ®ç®¡ç†å‘½ä»¤**

  ```bash
  # ä¸‹è½½å†å²æ•°æ®
  npm run backtest:download-data -- \
    --symbols BTC,ETH,SOL \
    --start 2024-01-01 \
    --end 2024-12-31 \
    --exchange gate
  
  # æ£€æŸ¥æ•°æ®è´¨é‡
  npm run backtest:check-data -- --symbols BTC,ETH --start 2024-01-01
  
  # æ¸…ç†ç¼“å­˜
  npm run backtest:clear-cache
  ```

**äº¤ä»˜ç‰©ï¼š**

- `scripts/backtest.ts`ï¼ˆä¸»å…¥å£ï¼‰
- `scripts/backtest-download-data.ts`
- `scripts/backtest-compare.ts`
- `scripts/backtest-optimize.ts`
- `package.json`ï¼ˆæ·»åŠ  npm scriptsï¼‰

---

#### 4.2 ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ âœ…

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **äº¤æ˜“æ‰€å·¥å‚æ‰©å±•**

  ```typescript
  // src/exchanges/ExchangeFactory.ts
  export function createExchangeClient(config: ExchangeConfig): IExchangeClient {
    if (config.mode === 'backtest') {
      return new BacktestExchangeClient({
        backtestConfig: config.backtestConfig,
        candleCache: config.candleCache
      });
    }
    
    // ç°æœ‰å®ç›˜é€»è¾‘
    if (config.exchangeName === 'gate') {
      return new GateExchangeClient(config);
    }
    // ...
  }
  ```

- [ ] **ç¯å¢ƒå˜é‡æ”¯æŒ**

  ```env
  # .env.backtest
  MODE=backtest
  BACKTEST_START_DATE=2024-01-01
  BACKTEST_END_DATE=2024-12-31
  BACKTEST_SYMBOLS=BTC,ETH,SOL
  BACKTEST_PRECISION=standard
  ```

- [ ] **æ•°æ®åº“éš”ç¦»**
  - å›æµ‹ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“ï¼ˆ`backtest.db`ï¼‰
  - é¿å…æ±¡æŸ“ç”Ÿäº§æ•°æ®åº“
  - æ”¯æŒå¹¶è¡Œè¿è¡Œå¤šä¸ªå›æµ‹

**äº¤ä»˜ç‰©ï¼š**

- æ›´æ–° `src/exchanges/ExchangeFactory.ts`
- `.env.backtest.example`
- é›†æˆæµ‹è¯•

---

### Phase 5: é«˜çº§ç‰¹æ€§ï¼ˆå¯é€‰ï¼ŒWeek 8+ï¼‰

#### 5.1 Walk-Forward åˆ†æ ğŸ”„

**ç›®æ ‡**ï¼šé¿å…è¿‡æ‹Ÿåˆï¼ŒéªŒè¯ç­–ç•¥åœ¨æœªæ¥æ•°æ®çš„è¡¨ç°

```typescript
class WalkForwardAnalyzer {
  async run(config: WalkForwardConfig): Promise<WalkForwardResult> {
    const periods = this.splitTimePeriods(config);
    
    for (const period of periods) {
      // 1. åœ¨è®­ç»ƒé›†ä¼˜åŒ–å‚æ•°
      const bestParams = await this.optimize(period.train);
      
      // 2. åœ¨éªŒè¯é›†æµ‹è¯•è¡¨ç°
      const testResult = await this.backtest(period.test, bestParams);
      
      // 3. è®°å½•ç»“æœ
      this.results.push(testResult);
    }
    
    return this.aggregateResults();
  }
}
```

---

#### 5.2 è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿ ğŸ²

**ç›®æ ‡**ï¼šè¯„ä¼°ç­–ç•¥åœ¨ä¸åŒå¸‚åœºåœºæ™¯ä¸‹çš„ç¨³å¥æ€§

```typescript
class MonteCarloSimulator {
  async run(config: MonteCarloConfig): Promise<MonteCarloResult> {
    const results = [];
    
    for (let i = 0; i < config.iterations; i++) {
      // æ‰“ä¹±äº¤æ˜“é¡ºåºï¼ˆä¿æŒå¸‚åœºæ•°æ®ä¸å˜ï¼‰
      const shuffledTrades = this.shuffleTrades(this.originalTrades);
      
      // è¿è¡Œå›æµ‹
      const result = await this.runBacktest(shuffledTrades);
      results.push(result);
    }
    
    // åˆ†æç»“æœåˆ†å¸ƒ
    return {
      avgReturn: this.calculateAvg(results),
      stdReturn: this.calculateStd(results),
      worstCase: this.calculatePercentile(results, 5),  // 5% åˆ†ä½æ•°
      bestCase: this.calculatePercentile(results, 95),   // 95% åˆ†ä½æ•°
    };
  }
}
```

---

#### 5.3 å®ç›˜å¯¹æ¯”éªŒè¯ âœ…

**ç›®æ ‡**ï¼šç¡®ä¿å›æµ‹ä¸å®ç›˜ä¸€è‡´æ€§

```typescript
class BacktestValidator {
  async validate(liveResult: LiveTradingResult): Promise<ValidationReport> {
    // 1. ä½¿ç”¨ç›¸åŒæ—¶é—´æ®µã€ç›¸åŒé…ç½®è¿è¡Œå›æµ‹
    const backtestResult = await this.runBacktest({
      startDate: liveResult.startDate,
      endDate: liveResult.endDate,
      symbols: liveResult.symbols,
      strategy: liveResult.strategy
    });
    
    // 2. å¯¹æ¯”å…³é”®æŒ‡æ ‡
    const comparison = {
      returnDiff: Math.abs(backtestResult.return - liveResult.return),
      tradeCountDiff: Math.abs(backtestResult.trades - liveResult.trades),
      sharpeRatioDiff: Math.abs(backtestResult.sharpe - liveResult.sharpe),
    };
    
    // 3. ç”Ÿæˆè­¦å‘Šï¼ˆå¦‚æœå·®å¼‚è¿‡å¤§ï¼‰
    const warnings = [];
    if (comparison.returnDiff > 0.05) {  // æ”¶ç›Šç‡å·®å¼‚ > 5%
      warnings.push('æ”¶ç›Šç‡å·®å¼‚è¿‡å¤§ï¼Œå¯èƒ½å­˜åœ¨å›æµ‹åå·®');
    }
    
    return { comparison, warnings };
  }
}
```

---

## ğŸ“Š æ•°æ®éœ€æ±‚åˆ†æ

### å¿…éœ€æ•°æ®

| æ•°æ®ç±»å‹ | æ—¶é—´æ¡†æ¶ | å­˜å‚¨é‡ä¼°ç®— | ä¼˜å…ˆçº§ |
|---------|---------|----------|--------|
| Kçº¿æ•°æ® | 5m, 15m, 1h, 4h | ~50MB/å¸ç§/å¹´ | â­â­â­â­â­ |
| æŠ€æœ¯æŒ‡æ ‡ | å®æ—¶è®¡ç®— | 0 (ä¸å­˜å‚¨) | â­â­â­â­â­ |
| èµ„é‡‘è´¹ç‡ | 8h | ~1MB/å¸ç§/å¹´ | â­â­â­ |

### å¯é€‰æ•°æ®ï¼ˆæå‡ç²¾åº¦ï¼‰

| æ•°æ®ç±»å‹ | ç”¨é€” | å­˜å‚¨é‡ä¼°ç®— | ä¼˜å…ˆçº§ |
|---------|------|----------|--------|
| è®¢å•ç°¿å¿«ç…§ | ç²¾ç¡®æ»‘ç‚¹æ¨¡æ‹Ÿ | ~500MB/å¸ç§/å¹´ | â­â­ |
| Tick æ•°æ® | é«˜é¢‘ç­–ç•¥å›æµ‹ | ~5GB/å¸ç§/å¹´ | â­ |
| æ¸…ç®—æ•°æ® | å¸‚åœºæƒ…ç»ªåˆ†æ | ~10MB/å¸ç§/å¹´ | â­â­ |

---

## ğŸ¯ å…³é”®éªŒè¯æŒ‡æ ‡

### å›æµ‹è´¨é‡è¯„ä¼°

- [ ] **æ•°æ®å®Œæ•´æ€§**ï¼šKçº¿ç¼ºå¤±ç‡ < 1%
- [ ] **æ‰§è¡Œå»¶è¿Ÿ**ï¼šè®¢å•å¤„ç†æ—¶é—´ < 100msï¼ˆæ¨¡æ‹Ÿï¼‰
- [ ] **æ»‘ç‚¹åˆç†æ€§**ï¼šå¹³å‡æ»‘ç‚¹ 0.01-0.05%
- [ ] **æ‰‹ç»­è´¹å‡†ç¡®æ€§**ï¼šä¸äº¤æ˜“æ‰€å®é™…è´¹ç‡ä¸€è‡´

### å›æµ‹ç»“æœå¯ä¿¡åº¦

- [ ] **å®ç›˜å¯¹æ¯”**ï¼šæ”¶ç›Šç‡å·®å¼‚ < 10%
- [ ] **äº¤æ˜“æ¬¡æ•°**ï¼šå›æµ‹ vs å®ç›˜å·®å¼‚ < 20%
- [ ] **å¤æ™®æ¯”ç‡**ï¼šå·®å¼‚ < 0.3
- [ ] **æœ€å¤§å›æ’¤**ï¼šå·®å¼‚ < 5%

### æ€§èƒ½æŒ‡æ ‡

- [ ] **å›æµ‹é€Ÿåº¦**ï¼š1å¹´æ•°æ® < 10åˆ†é’Ÿï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰
- [ ] **å†…å­˜å ç”¨**ï¼š< 2GBï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰
- [ ] **å¹¶è¡Œèƒ½åŠ›**ï¼šæ”¯æŒåŒæ—¶è¿è¡Œ 3+ å›æµ‹ä»»åŠ¡

---

## ğŸš§ æ½œåœ¨é™·é˜±ä¸åº”å¯¹

### 1. å‰è§†åå·®ï¼ˆLook-Ahead Biasï¼‰

**é—®é¢˜**ï¼šä½¿ç”¨æœªæ¥æ•°æ®åšå†³ç­–

**åº”å¯¹**ï¼š

- âœ… ä¸¥æ ¼æŒ‰æ—¶é—´é¡ºåºå¤„ç†æ•°æ®
- âœ… æŠ€æœ¯æŒ‡æ ‡åªä½¿ç”¨å†å²æ•°æ®
- âœ… ä»£ç å®¡æŸ¥ç¡®ä¿æ— æœªæ¥ä¿¡æ¯æ³„éœ²

### 2. å¹¸å­˜è€…åå·®ï¼ˆSurvivorship Biasï¼‰

**é—®é¢˜**ï¼šåªæµ‹è¯•ç°å­˜å¸ç§ï¼Œå¿½ç•¥å·²ä¸‹æ¶å¸ç§

**åº”å¯¹**ï¼š

- âœ… åŒ…å«å†å²ä¸Šå·²ä¸‹æ¶çš„å¸ç§
- âœ… æ¨¡æ‹Ÿåˆçº¦ä¸‹æ¶åœºæ™¯ï¼ˆå¼ºåˆ¶å¹³ä»“ï¼‰
- âœ… è®°å½•ä¸å¯äº¤æ˜“æ—¶æ®µ

### 3. è¿‡æ‹Ÿåˆï¼ˆOverfittingï¼‰

**é—®é¢˜**ï¼šç­–ç•¥åœ¨å†å²æ•°æ®å®Œç¾ï¼Œå®ç›˜å¤±æ•ˆ

**åº”å¯¹**ï¼š

- âœ… ä½¿ç”¨ Walk-Forward åˆ†æ
- âœ… æ ·æœ¬å¤–æµ‹è¯•ï¼ˆOut-of-Sampleï¼‰
- âœ… é¿å…è¿‡åº¦å‚æ•°ä¼˜åŒ–
- âœ… è’™ç‰¹å¡ç½—æ¨¡æ‹ŸéªŒè¯ç¨³å¥æ€§

### 4. æ•°æ®è´¨é‡é—®é¢˜

**é—®é¢˜**ï¼šå†å²æ•°æ®é”™è¯¯ã€ç¼ºå¤±ã€ä¸ä¸€è‡´

**åº”å¯¹**ï¼š

- âœ… å¤šæºæ•°æ®äº¤å‰éªŒè¯
- âœ… å¼‚å¸¸å€¼æ£€æµ‹ä¸æ¸…æ´—
- âœ… æ•°æ®è´¨é‡æŠ¥å‘Š
- âœ… æ‰‹åŠ¨æŠ½æŸ¥å…³é”®æ—¶é—´ç‚¹

### 5. å¸‚åœºå¾®è§‚ç»“æ„å¿½è§†

**é—®é¢˜**ï¼šå¿½ç•¥å®ç›˜çš„è®¢å•ç°¿ã€æ»‘ç‚¹ã€å»¶è¿Ÿ

**åº”å¯¹**ï¼š

- âœ… ä¿å®ˆæ»‘ç‚¹ä¼°ç®—
- âœ… æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
- âœ… å¤§å•ä»·æ ¼å†²å‡»æ¨¡å‹
- âœ… å®ç›˜æ ¡å‡†å›æµ‹å‚æ•°

---

## ğŸ“… é‡Œç¨‹ç¢‘ä¸äº¤ä»˜

### Milestone 1: æ•°æ®ä¸åŸºç¡€è®¾æ–½ (Week 2)

- âœ… å†å²æ•°æ®ä¸‹è½½å™¨
- âœ… æ•°æ®è´¨é‡éªŒè¯
- âœ… æ¨¡æ‹Ÿäº¤æ˜“æ‰€æ¡†æ¶

### Milestone 2: æ ¸å¿ƒå¼•æ“ (Week 4)

- âœ… å›æµ‹å¼•æ“å¯è¿è¡Œ
- âœ… ç®€å•ç­–ç•¥å›æµ‹æˆåŠŸ
- âœ… åŸºæœ¬ç»©æ•ˆæŒ‡æ ‡è®¡ç®—

### Milestone 3: å®Œæ•´æŠ¥å‘Š (Week 6)

- âœ… HTML/Markdown æŠ¥å‘Šç”Ÿæˆ
- âœ… å…³é”®å›¾è¡¨å¯è§†åŒ–
- âœ… AI å†³ç­–åˆ†æ

### Milestone 4: ç”Ÿäº§å°±ç»ª (Week 7)

- âœ… CLI å·¥å…·å®Œå–„
- âœ… æ–‡æ¡£å®Œå¤‡
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

### Milestone 5: é«˜çº§åŠŸèƒ½ (Week 8+)

- â­ Walk-Forward åˆ†æ
- â­ è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿ
- â­ å®ç›˜è‡ªåŠ¨å¯¹æ¯”

---

## ğŸ› ï¸ æŠ€æœ¯å€ºåŠ¡ä¸ä¼˜åŒ–

### çŸ­æœŸï¼ˆPhase 1-4ï¼‰

- [ ] åŸºæœ¬åŠŸèƒ½å®ç°
- [ ] ä»£ç å¯è¯»æ€§ä¼˜å…ˆ
- [ ] å¿«é€Ÿè¿­ä»£éªŒè¯

### ä¸­æœŸï¼ˆPhase 5+ï¼‰

- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¹¶è¡Œã€ç¼“å­˜ï¼‰
- [ ] ä»£ç é‡æ„ï¼ˆæ¶ˆé™¤é‡å¤ï¼‰
- [ ] å®Œå–„é”™è¯¯å¤„ç†

### é•¿æœŸ

- [ ] åˆ†å¸ƒå¼å›æµ‹ï¼ˆå¤šæœºå¹¶è¡Œï¼‰
- [ ] GPU åŠ é€Ÿè®¡ç®—
- [ ] å®æ—¶æµå¼å›æµ‹

---

## ğŸ“š æ–‡æ¡£è®¡åˆ’

### ç”¨æˆ·æ–‡æ¡£

- [ ] `docs/å›æµ‹ç³»ç»Ÿå¿«é€Ÿå¼€å§‹.md`
- [ ] `docs/å›æµ‹é…ç½®æŒ‡å—.md`
- [ ] `docs/å›æµ‹æŠ¥å‘Šè§£è¯».md`
- [ ] `docs/å›æµ‹å¸¸è§é—®é¢˜FAQ.md`

### å¼€å‘æ–‡æ¡£

- [ ] `docs/å›æµ‹ç³»ç»Ÿæ¶æ„è®¾è®¡.md`
- [ ] `docs/å›æµ‹æ•°æ®æ ¼å¼è§„èŒƒ.md`
- [ ] `docs/å›æµ‹å¼•æ“APIæ–‡æ¡£.md`
- [ ] `docs/å›æµ‹ç³»ç»Ÿæµ‹è¯•æŒ‡å—.md`

### ç ”ç©¶æ–‡æ¡£

- [ ] `docs/å›æµ‹åå·®åˆ†æä¸åº”å¯¹.md`
- [ ] `docs/å›æµ‹ä¸å®ç›˜å¯¹æ¯”ç ”ç©¶.md`
- [ ] `docs/ç­–ç•¥å‚æ•°æ•æ„Ÿæ€§åˆ†æ.md`

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§

- [ ] æ”¯æŒæ‰€æœ‰ç”Ÿäº§ç¯å¢ƒç­–ç•¥
- [ ] æ”¯æŒæ‰€æœ‰é£æ§æœºåˆ¶ï¼ˆæ­¢æŸã€æ­¢ç›ˆã€åˆ†æ‰¹æ­¢ç›ˆï¼‰
- [ ] æ”¯æŒå¤šå¸ç§ã€å¤šæ—¶é—´æ¡†æ¶
- [ ] ç”Ÿæˆå®Œæ•´çš„å›æµ‹æŠ¥å‘Š

### å‡†ç¡®æ€§

- [ ] ä¸å®ç›˜å¯¹æ¯”ï¼Œå…³é”®æŒ‡æ ‡å·®å¼‚ < 15%
- [ ] æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ä¸ TradingView ä¸€è‡´
- [ ] æ‰‹ç»­è´¹è®¡ç®—ç²¾ç¡®åˆ°å°æ•°ç‚¹å 4 ä½

### æ€§èƒ½

- [ ] 1å¹´æ•°æ®å›æµ‹ < 10åˆ†é’Ÿï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰
- [ ] æ”¯æŒå¹¶è¡Œè¿è¡Œå¤šä¸ªå›æµ‹
- [ ] å†…å­˜å ç”¨ < 2GB

### å¯ç”¨æ€§

- [ ] CLI å·¥å…·æ˜“ç”¨ï¼Œå‚æ•°æ¸…æ™°
- [ ] æŠ¥å‘Šå¯è¯»æ€§å¼ºï¼Œå›¾è¡¨ç¾è§‚
- [ ] æ–‡æ¡£å®Œå¤‡ï¼Œç¤ºä¾‹ä¸°å¯Œ

### å¯ç»´æŠ¤æ€§

- [ ] ä»£ç ç¬¦åˆ TypeScript è§„èŒƒ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] å…³é”®æ¨¡å—æœ‰æ³¨é‡Šå’Œæ–‡æ¡£

---

## ğŸ‰ é¢„æœŸæ”¶ç›Š

### 1. å¼€å‘æ•ˆç‡æå‡

- âš¡ **å¿«é€ŸéªŒè¯**ï¼šä»æ•°å‘¨ç¼©çŸ­åˆ°æ•°å°æ—¶
- ğŸš« **é¿å…æ— æ•ˆå¼€å‘**ï¼šæå‰å‘ç°æ˜æ˜¾æ— æ•ˆçš„æƒ³æ³•
- ğŸ¯ **ç²¾å‡†ä¼˜åŒ–**ï¼šæ•°æ®é©±åŠ¨çš„å‚æ•°è°ƒä¼˜

### 2. ç­–ç•¥è´¨é‡æå‡

- ğŸ“Š **é‡åŒ–è¯„ä¼°**ï¼šå®¢è§‚è¯„ä¼°ç­–ç•¥è¡¨ç°
- ğŸ” **å‘ç°é—®é¢˜**ï¼šè¯†åˆ«ç³»ç»Ÿæ€§ç¼ºé™·
- ğŸ’ª **å¢å¼ºä¿¡å¿ƒ**ï¼šå……åˆ†å›æµ‹åå†ä¸Šçº¿

### 3. é£é™©æ§åˆ¶æå‡

- ğŸ›¡ï¸ **å‹åŠ›æµ‹è¯•**ï¼šæç«¯å¸‚åœºä¸‹çš„è¡¨ç°
- ğŸ“‰ **å›æ’¤é¢„è­¦**ï¼šäº†è§£æœ€åæƒ…å†µ
- âš–ï¸ **é£é™©æ ¡å‡†**ï¼šè°ƒæ•´é£æ§å‚æ•°

### 4. é•¿æœŸä»·å€¼

- ğŸ§ª **ç ”ç©¶å¹³å°**ï¼šæŒç»­æ”¹è¿›ç­–ç•¥
- ğŸ“š **çŸ¥è¯†ç§¯ç´¯**ï¼šå»ºç«‹ç­–ç•¥åº“
- ğŸ¤ **å›¢é˜Ÿåä½œ**ï¼šæ ‡å‡†åŒ–æµ‹è¯•æµç¨‹

---

## ğŸ“ è”ç³»ä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿ï¼š

- æäº¤ GitHub Issue
- å‚ä¸ä»£ç å®¡æŸ¥
- è´¡çŒ®å›æµ‹æ¨¡å—

---

**æœ€åæ›´æ–°**ï¼š2025-11-13  
**ç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šå¾…å®¡é˜… â†’ å¾…å®æ–½
