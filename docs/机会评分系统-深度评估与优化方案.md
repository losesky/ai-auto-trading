# æœºä¼šè¯„åˆ†ç³»ç»Ÿ - æ·±åº¦è¯„ä¼°ä¸ä¼˜åŒ–æ–¹æ¡ˆ

> **æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-19  
> **è¯„ä¼°å¯¹è±¡**: `src/services/opportunityScorer.ts`  
> **è¯„ä¼°ç»´åº¦**: é€»è¾‘åˆç†æ€§ã€å‚æ•°ç§‘å­¦æ€§ã€ç­–ç•¥é€‚é…æ€§ã€å®æˆ˜å¯è¡Œæ€§  
> **ä¼˜åŒ–ç›®æ ‡**: ç»“åˆç­–ç•¥è‡ªé€‚åº”æ—¶é—´æ¡†æ¶ä¼˜åŒ–,æå‡è¯„åˆ†ç³»ç»Ÿçš„ç²¾å‡†åº¦å’Œå®æˆ˜æ•ˆæœ

---

## ğŸ“Š ä¸€ã€å½“å‰è¯„åˆ†ç³»ç»Ÿåˆ†æ

### 1.1 è¯„åˆ†æ¡†æ¶

- **äº”ç»´è¯„åˆ†æ¨¡å‹ï¼ˆ0-100åˆ†ï¼‰**

```text
ç»´åº¦             æƒé‡    è¯„åˆ†èŒƒå›´    å½“å‰å®ç°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. ä¿¡å·å¼ºåº¦      30%     0-30åˆ†     âœ… åŸºäºç­–ç•¥ä¿¡å·å¼ºåº¦
2. è¶‹åŠ¿ä¸€è‡´æ€§    25%     0-25åˆ†     âœ… åŸºäºå¤šæ—¶é—´æ¡†æ¶å¯¹é½åº¦
3. æ³¢åŠ¨ç‡é€‚é…    20%     0-20åˆ†     âœ… åŸºäºATRæ¯”ç‡
4. é£é™©æ”¶ç›Šæ¯”    15%     0-15åˆ†     âœ… åŸºäºå¸‚åœºçŠ¶æ€å’Œæ æ†
5. æµåŠ¨æ€§è¯„åˆ†    10%     0-10åˆ†     âœ… åŸºäºå¸ç§æµåŠ¨æ€§

æ€»åˆ† = Î£(å„ç»´åº¦å¾—åˆ†)
ç½®ä¿¡åº¦ = { high(â‰¥75), medium(60-74), low(<60) }
æœ€ä½å¼€ä»“é˜ˆå€¼ = ENV.MIN_OPPORTUNITY_SCORE (é»˜è®¤75åˆ†)
```

### 1.2 æ ¸å¿ƒé€»è¾‘è¯„ä¼°

#### âœ… ä¼˜ç‚¹

1. **å¤šç»´åº¦ç»¼åˆè¯„ä¼°**
   - ä¸ä¾èµ–å•ä¸€æŒ‡æ ‡,é™ä½å‡ä¿¡å·é£é™©
   - è¦†ç›–è¶‹åŠ¿ã€åŠ¨é‡ã€æ³¢åŠ¨ç‡ã€æµåŠ¨æ€§ç­‰å…³é”®å› ç´ 

2. **å¸‚åœºçŠ¶æ€æ„ŸçŸ¥**
   - æ ¹æ® `marketState.state` åŠ¨æ€è°ƒæ•´åŸºç¡€è¯„åˆ†
   - è¯†åˆ«æœ€ä½³å…¥åœºæ—¶æœºï¼ˆoversold/overboughtï¼‰

3. **é£é™©æ„è¯†**
   - é«˜æ æ†é™ä½é£é™©æ”¶ç›Šæ¯”è¯„åˆ†
   - æ³¢åŠ¨ç‡è¿‡é«˜æˆ–è¿‡ä½éƒ½ä¼šæ‰£åˆ†

#### âš ï¸ é—®é¢˜

1. **waitä¿¡å·è¯„åˆ†è¿‡ä½ï¼ˆå·²éƒ¨åˆ†ä¿®å¤ï¼‰**

   ```typescript
   å½“å‰: downtrend_continuation + wait â†’ 45åˆ†
        uptrend_oversold + wait â†’ 55åˆ†
        ranging + wait â†’ 30åˆ†
   
   é—®é¢˜: è™½ç„¶å·²æé«˜åŸºç¡€åˆ†,ä½†ä»å¯èƒ½é”™è¿‡åˆç†è¶‹åŠ¿å»¶ç»­æœºä¼š
   ```

2. **æœªè€ƒè™‘ç­–ç•¥å·®å¼‚**

   ```typescript
   é—®é¢˜: æ‰€æœ‰ç­–ç•¥ä½¿ç”¨ç›¸åŒçš„è¯„åˆ†æƒé‡å’Œé˜ˆå€¼
   å®é™…: 
   - ultra-short åº”æ›´çœ‹é‡ä¿¡å·å¼ºåº¦å’ŒæµåŠ¨æ€§
   - swing-trend åº”æ›´çœ‹é‡è¶‹åŠ¿ä¸€è‡´æ€§
   - conservative åº”æ›´çœ‹é‡é£é™©æ”¶ç›Šæ¯”
   ```

3. **æ³¢åŠ¨ç‡é€‚é…é€»è¾‘å•ä¸€**

   ```typescript
   å½“å‰: ç†æƒ³ATRèŒƒå›´ 0.8-1.2 ç»Ÿä¸€æ ‡å‡†
   é—®é¢˜: ä¸åŒç­–ç•¥å¯¹æ³¢åŠ¨ç‡çš„éœ€æ±‚ä¸åŒ
   - ultra-short é€‚åˆè¾ƒé«˜æ³¢åŠ¨ç‡ (1.0-1.5)
   - conservative é€‚åˆç¨³å®šæ³¢åŠ¨ç‡ (0.7-1.0)
   ```

4. **æµåŠ¨æ€§è¯„åˆ†ç²—ç³™**

   ```typescript
   å½“å‰: ç¡¬ç¼–ç ä¸‰æ¡£æµåŠ¨æ€§ (ä¸»æµ1.0, äºŒçº¿0.8, å…¶ä»–0.6)
   é—®é¢˜: 
   - æœªè€ƒè™‘24hæˆäº¤é‡
   - æœªè€ƒè™‘æ·±åº¦å’Œæ»‘ç‚¹
   - å¸ç§åˆ†ç±»å¯èƒ½è¿‡æ—¶
   ```

5. **é£é™©æ”¶ç›Šæ¯”è®¡ç®—ä¸å¤Ÿç²¾ç»†**

   ```typescript
   å½“å‰: åŸºäºå¸‚åœºçŠ¶æ€çš„å›ºå®šåŸºç¡€å€¼ + æ æ†è°ƒæ•´
   é—®é¢˜:
   - æœªè€ƒè™‘å®é™…æ­¢æŸ/æ­¢ç›ˆè·ç¦»
   - æœªè€ƒè™‘å“ç§ç‰¹æ€§ï¼ˆBTC vs å±±å¯¨å¸ï¼‰
   - æœªä¸ç§‘å­¦æ­¢æŸç³»ç»Ÿé›†æˆ
   ```

---

## ğŸ¯ äºŒã€ç­–ç•¥è‡ªé€‚åº”ä¼˜åŒ–æ–¹æ¡ˆ

### 2.1 ç­–ç•¥å·®å¼‚åŒ–æƒé‡é…ç½®

**æ ¸å¿ƒæ€æƒ³**: ä¸åŒç­–ç•¥å…³æ³¨ç‚¹ä¸åŒ,åº”ä½¿ç”¨å·®å¼‚åŒ–çš„è¯„åˆ†æƒé‡

```typescript
/**
 * ç­–ç•¥å·®å¼‚åŒ–æƒé‡é…ç½®è¡¨
 */
interface StrategyScoreWeights {
  signalStrength: number;     // ä¿¡å·å¼ºåº¦æƒé‡
  trendConsistency: number;   // è¶‹åŠ¿ä¸€è‡´æ€§æƒé‡
  volatilityFit: number;      // æ³¢åŠ¨ç‡é€‚é…æƒé‡
  riskRewardRatio: number;    // é£é™©æ”¶ç›Šæ¯”æƒé‡
  liquidity: number;          // æµåŠ¨æ€§æƒé‡
  minScore: number;           // æœ€ä½å¼€ä»“é˜ˆå€¼
}

const STRATEGY_SCORE_WEIGHTS: Record<TradingStrategy, StrategyScoreWeights> = {
  // è¶…çŸ­çº¿: çœ‹é‡ä¿¡å·å¼ºåº¦å’ŒæµåŠ¨æ€§,å¿«é€Ÿå“åº”
  "ultra-short": {
    signalStrength: 35,      // +5 æ›´çœ‹é‡ä¿¡å·
    trendConsistency: 20,    // -5 çŸ­æœŸè¶‹åŠ¿å¯èƒ½ä¸ç¨³
    volatilityFit: 20,
    riskRewardRatio: 10,     // -5 è¿½æ±‚é€Ÿåº¦è€Œéæ¯”ä¾‹
    liquidity: 15,           // +5 éœ€è¦å¿«é€Ÿæˆäº¤
    minScore: 65,            // -10 é™ä½é˜ˆå€¼,å¢åŠ æœºä¼š
  },
  
  // æ¿€è¿›ç­–ç•¥: å¹³è¡¡ä¿¡å·å’Œè¶‹åŠ¿,æ¥å—ä¸€å®šé£é™©
  "aggressive": {
    signalStrength: 30,
    trendConsistency: 25,
    volatilityFit: 20,
    riskRewardRatio: 12,     // -3 å¯æ¥å—è¾ƒä½R:R
    liquidity: 13,           // +3 éœ€è¦è‰¯å¥½æµåŠ¨æ€§
    minScore: 70,            // -5 ç¨å¾®é™ä½é˜ˆå€¼
  },
  
  // å¹³è¡¡ç­–ç•¥: æ ‡å‡†é…ç½®(å½“å‰é»˜è®¤)
  "balanced": {
    signalStrength: 30,
    trendConsistency: 25,
    volatilityFit: 20,
    riskRewardRatio: 15,
    liquidity: 10,
    minScore: 75,            // æ ‡å‡†é˜ˆå€¼
  },
  
  // ç¨³å¥ç­–ç•¥: é«˜åº¦çœ‹é‡é£é™©æ”¶ç›Šæ¯”å’Œè¶‹åŠ¿ä¸€è‡´æ€§
  "conservative": {
    signalStrength: 25,      // -5 ä¿¡å·å¯ä»¥æ…¢ä¸€äº›
    trendConsistency: 30,    // +5 æ›´çœ‹é‡è¶‹åŠ¿ç¡®è®¤
    volatilityFit: 15,       // -5 æ¥å—ä½æ³¢åŠ¨
    riskRewardRatio: 20,     // +5 ä¸¥æ ¼è¦æ±‚R:R
    liquidity: 10,
    minScore: 80,            // +5 æé«˜é˜ˆå€¼,å®ç¼ºæ¯‹æ»¥
  },
  
  // æ³¢æ®µè¶‹åŠ¿: æåº¦çœ‹é‡è¶‹åŠ¿ä¸€è‡´æ€§,å¿½ç•¥çŸ­æœŸä¿¡å·
  "swing-trend": {
    signalStrength: 20,      // -10 ä¸è¿½æ±‚ç²¾å‡†å…¥åœº
    trendConsistency: 35,    // +10 ä¸‰å±‚æ—¶é—´æ¡†æ¶éªŒè¯
    volatilityFit: 15,       // -5 æ¥å—ä½æ³¢åŠ¨
    riskRewardRatio: 20,     // +5 è¿½æ±‚å¤§R:R
    liquidity: 10,
    minScore: 78,            // +3 é«˜è´¨é‡ä¿¡å·
  },
};
```

**å®æ–½ä¼˜åŠ¿**:

âœ… è¶…çŸ­çº¿ç­–ç•¥æ›´å®¹æ˜“è§¦å‘ï¼ˆ65åˆ†é˜ˆå€¼ï¼‰ï¼Œæ•æ‰çŸ­æœŸæœºä¼š  
âœ… ç¨³å¥/æ³¢æ®µç­–ç•¥æ›´è°¨æ…ï¼ˆ78-80åˆ†é˜ˆå€¼ï¼‰ï¼Œé¿å…å‡çªç ´  
âœ… æƒé‡ä¸ç­–ç•¥æ—¶é—´æ¡†æ¶é…ç½®ååŒå·¥ä½œ

---

### 2.2 æ³¢åŠ¨ç‡é€‚é…ç­–ç•¥åŒ–

**å½“å‰é—®é¢˜**: æ‰€æœ‰ç­–ç•¥ä½¿ç”¨ç»Ÿä¸€çš„ç†æƒ³æ³¢åŠ¨ç‡èŒƒå›´ (0.8-1.2)

**ä¼˜åŒ–æ–¹æ¡ˆ**: æ ¹æ®ç­–ç•¥ç‰¹æ€§å®šåˆ¶æ³¢åŠ¨ç‡åå¥½

```typescript
/**
 * ç­–ç•¥æ³¢åŠ¨ç‡åå¥½é…ç½®
 */
interface VolatilityPreference {
  idealMin: number;    // ç†æƒ³æ³¢åŠ¨ç‡ä¸‹é™
  idealMax: number;    // ç†æƒ³æ³¢åŠ¨ç‡ä¸Šé™
  acceptableMin: number; // å¯æ¥å—ä¸‹é™
  acceptableMax: number; // å¯æ¥å—ä¸Šé™
  penaltyFactor: number; // åç¦»æƒ©ç½šç³»æ•°
}

const STRATEGY_VOLATILITY_PREFS: Record<TradingStrategy, VolatilityPreference> = {
  "ultra-short": {
    idealMin: 1.0,        // åå¥½è¾ƒé«˜æ³¢åŠ¨
    idealMax: 1.5,
    acceptableMin: 0.8,
    acceptableMax: 2.0,
    penaltyFactor: 0.4,   // æ¸©å’Œæƒ©ç½š,æ¥å—æ³¢åŠ¨
  },
  
  "aggressive": {
    idealMin: 0.9,
    idealMax: 1.4,
    acceptableMin: 0.7,
    acceptableMax: 1.8,
    penaltyFactor: 0.5,
  },
  
  "balanced": {
    idealMin: 0.8,        // æ ‡å‡†é…ç½®
    idealMax: 1.2,
    acceptableMin: 0.6,
    acceptableMax: 1.5,
    penaltyFactor: 0.5,
  },
  
  "conservative": {
    idealMin: 0.6,        // åå¥½ä½æ³¢åŠ¨
    idealMax: 1.0,
    acceptableMin: 0.5,
    acceptableMax: 1.3,
    penaltyFactor: 0.7,   // ä¸¥æ ¼æƒ©ç½šé«˜æ³¢åŠ¨
  },
  
  "swing-trend": {
    idealMin: 0.7,
    idealMax: 1.1,
    acceptableMin: 0.5,
    acceptableMax: 1.4,
    penaltyFactor: 0.6,
  },
};

/**
 * ç­–ç•¥åŒ–æ³¢åŠ¨ç‡è¯„åˆ†å‡½æ•°
 */
function calculateVolatilityFitScore(
  marketState: MarketStateAnalysis,
  strategy: TradingStrategy
): number {
  const atrRatio = marketState.keyMetrics.atr_ratio;
  const pref = STRATEGY_VOLATILITY_PREFS[strategy];
  
  // ç†æƒ³åŒºé—´ -> æ»¡åˆ†
  if (atrRatio >= pref.idealMin && atrRatio <= pref.idealMax) {
    return 1.0;
  }
  
  // å¯æ¥å—åŒºé—´ -> çº¿æ€§è¡°å‡
  if (atrRatio >= pref.acceptableMin && atrRatio <= pref.acceptableMax) {
    if (atrRatio < pref.idealMin) {
      // ä½äºç†æƒ³ä¸‹é™
      const distance = pref.idealMin - atrRatio;
      const range = pref.idealMin - pref.acceptableMin;
      return 1.0 - (distance / range) * pref.penaltyFactor;
    } else {
      // é«˜äºç†æƒ³ä¸Šé™
      const distance = atrRatio - pref.idealMax;
      const range = pref.acceptableMax - pref.idealMax;
      return 1.0 - (distance / range) * pref.penaltyFactor;
    }
  }
  
  // è¶…å‡ºå¯æ¥å—èŒƒå›´ -> æœ€ä½åˆ†
  return 0.3;
}
```

**æ•ˆæœé¢„æœŸ**:

- ultra-short åœ¨é«˜æ³¢åŠ¨è¡Œæƒ…å¾—åˆ†æ›´é«˜ âœ…
- conservative åœ¨ç¨³å®šè¡Œæƒ…å¾—åˆ†æ›´é«˜ âœ…
- é¿å…"ä¸€åˆ€åˆ‡"è¯„åˆ†,æå‡ç­–ç•¥å·®å¼‚åŒ–

---

### 2.3 æµåŠ¨æ€§è¯„åˆ†åŠ¨æ€åŒ–

**å½“å‰é—®é¢˜**: ç¡¬ç¼–ç å¸ç§åˆ—è¡¨,æœªè€ƒè™‘å®æ—¶æˆäº¤é‡

**ä¼˜åŒ–æ–¹æ¡ˆ**: ç»“åˆé™æ€åˆ†çº§å’ŒåŠ¨æ€æˆäº¤é‡

```typescript
/**
 * æµåŠ¨æ€§è¯„åˆ†ä¼˜åŒ–
 */
function calculateLiquidityScore(
  symbol: string,
  strategy: TradingStrategy,
  volume24h?: number  // å¯é€‰çš„24hæˆäº¤é‡(USDT)
): number {
  // 1. åŸºç¡€é™æ€è¯„åˆ†
  let baseScore = 0.6; // é»˜è®¤
  
  const tier1 = ["BTC", "ETH"];  // è¶…çº§ä¸»æµ
  const tier2 = ["BNB", "SOL", "XRP", "ADA"];  // ä¸»æµ
  const tier3 = ["DOGE", "AVAX", "DOT", "MATIC", "LTC", "ARB", "OP"];  // äºŒçº¿
  
  if (tier1.includes(symbol)) {
    baseScore = 1.0;
  } else if (tier2.includes(symbol)) {
    baseScore = 0.85;
  } else if (tier3.includes(symbol)) {
    baseScore = 0.7;
  }
  
  // 2. åŠ¨æ€æˆäº¤é‡åŠ æˆï¼ˆå¦‚æœæœ‰æ•°æ®ï¼‰
  if (volume24h !== undefined) {
    if (volume24h >= 1_000_000_000) {  // â‰¥10äº¿USDT
      baseScore = Math.min(1.0, baseScore + 0.1);
    } else if (volume24h >= 500_000_000) {  // â‰¥5äº¿USDT
      baseScore = Math.min(1.0, baseScore + 0.05);
    } else if (volume24h < 100_000_000) {  // <1äº¿USDT
      baseScore = Math.max(0.3, baseScore - 0.1);
    }
  }
  
  // 3. ç­–ç•¥å·®å¼‚åŒ–è°ƒæ•´
  if (strategy === "ultra-short" && baseScore < 0.7) {
    // è¶…çŸ­çº¿å¯¹æµåŠ¨æ€§è¦æ±‚ä¸¥æ ¼
    baseScore *= 0.8;
  }
  
  if (strategy === "swing-trend" && baseScore >= 0.6) {
    // æ³¢æ®µç­–ç•¥å¯¹æµåŠ¨æ€§è¦æ±‚å®½æ¾
    baseScore = Math.min(1.0, baseScore + 0.05);
  }
  
  return baseScore;
}
```

**æœªæ¥æ‰©å±•**: å¯é›†æˆäº¤æ˜“æ‰€APIçš„å®æ—¶æ·±åº¦æ•°æ®

---

### 2.4 é£é™©æ”¶ç›Šæ¯”ç²¾ç»†åŒ–

**å½“å‰é—®é¢˜**: åŸºäºå¸‚åœºçŠ¶æ€çš„å›ºå®šåŸºç¡€å€¼,æœªè€ƒè™‘å®é™…æ­¢æŸ/æ­¢ç›ˆè·ç¦»

**ä¼˜åŒ–æ–¹æ¡ˆ**: é›†æˆç§‘å­¦æ­¢æŸç³»ç»Ÿ,è®¡ç®—å®é™…R:R

```typescript
/**
 * é£é™©æ”¶ç›Šæ¯”ç²¾ç»†è¯„åˆ†
 */
function calculateRiskRewardScore(
  strategyResult: StrategyResult,
  marketState: MarketStateAnalysis,
  strategy: TradingStrategy,
  scientificStopLoss?: {  // å¯é€‰çš„ç§‘å­¦æ­¢æŸæ•°æ®
    stopDistance: number;   // æ­¢æŸè·ç¦»%
    takeProfitDistance: number;  // æ­¢ç›ˆè·ç¦»%
  }
): number {
  // 1. åŸºç¡€R:Rè¯„åˆ†ï¼ˆåŸºäºå¸‚åœºçŠ¶æ€ï¼‰
  let baseRR = getBaseRRByMarketState(marketState.state);
  
  // 2. å¦‚æœæœ‰ç§‘å­¦æ­¢æŸæ•°æ®,ä½¿ç”¨å®é™…R:R
  if (scientificStopLoss) {
    const actualRR = scientificStopLoss.takeProfitDistance / scientificStopLoss.stopDistance;
    
    // R:Rè¯„åˆ†æ›²çº¿
    if (actualRR >= 3.0) {
      baseRR = 1.0;  // ä¼˜ç§€
    } else if (actualRR >= 2.0) {
      baseRR = 0.85;  // è‰¯å¥½
    } else if (actualRR >= 1.5) {
      baseRR = 0.7;   // åŠæ ¼
    } else {
      baseRR = 0.5;   // å‹‰å¼º
    }
  }
  
  // 3. æ æ†è°ƒæ•´ï¼ˆé«˜æ æ†é™ä½è¯„åˆ†ï¼‰
  const leverage = strategyResult.recommendedLeverage;
  if (leverage <= 2) {
    baseRR *= 0.95;  // ä½æ æ†ç¨é™ï¼ˆè¿½æ±‚ç¨³å¥ä½†æ”¶ç›Šæœ‰é™ï¼‰
  } else if (leverage >= 5) {
    baseRR *= 0.75;  // é«˜æ æ†å¤§é™ï¼ˆé£é™©è¿‡é«˜ï¼‰
  }
  
  // 4. ç­–ç•¥å·®å¼‚åŒ–è°ƒæ•´
  if (strategy === "conservative" && baseRR < 0.7) {
    // ç¨³å¥ç­–ç•¥å¯¹R:Rè¦æ±‚ä¸¥æ ¼
    baseRR *= 0.8;
  }
  
  if (strategy === "ultra-short") {
    // è¶…çŸ­çº¿ç­–ç•¥æ”¾å®½R:Rè¦æ±‚ï¼ˆè¿½æ±‚é€Ÿåº¦ï¼‰
    baseRR = Math.min(1.0, baseRR + 0.1);
  }
  
  return baseRR;
}

/**
 * åŸºäºå¸‚åœºçŠ¶æ€çš„åŸºç¡€R:R
 */
function getBaseRRByMarketState(state: string): number {
  // æœ€ä½³æ—¶æœºï¼ˆè¶‹åŠ¿ä¸­çš„å›è°ƒ/åå¼¹ï¼‰
  if (state === "uptrend_oversold" || state === "downtrend_overbought") {
    return 0.9;
  }
  
  // è¶‹åŠ¿å»¶ç»­ï¼ˆæ¬¡ä¼˜ï¼‰
  if (state === "uptrend_continuation" || state === "downtrend_continuation") {
    return 0.75;
  }
  
  // éœ‡è¡å¸‚å‡å€¼å›å½’
  if (state === "ranging_oversold" || state === "ranging_overbought") {
    return 0.8;
  }
  
  // å…¶ä»–çŠ¶æ€
  return 0.6;
}
```

**æœªæ¥é›†æˆç‚¹**:

- ä» `scientificStopLoss.ts` è·å–å®é™…æ­¢æŸè·ç¦»
- ä» `partialTakeProfitService.ts` è·å–åˆ†æ‰¹æ­¢ç›ˆè®¡åˆ’
- åŠ¨æ€è®¡ç®—æœŸæœ›æ”¶ç›Š/é£é™©æ¯”

---

### 2.5 waitä¿¡å·æ™ºèƒ½è¯„åˆ†

**å½“å‰é—®é¢˜**: waitä¿¡å·åŸºç¡€åˆ†å›ºå®š,æœªå……åˆ†è€ƒè™‘å¸‚åœºæœºä¼š

**ä¼˜åŒ–æ–¹æ¡ˆ**: æ ¹æ®å¸‚åœºçŠ¶æ€å’Œç­–ç•¥ç‰¹æ€§,åŠ¨æ€è°ƒæ•´waitè¯„åˆ†

```typescript
/**
 * waitä¿¡å·æ™ºèƒ½è¯„åˆ†
 */
function calculateWaitScore(
  strategyResult: StrategyResult,
  marketState: MarketStateAnalysis,
  strategy: TradingStrategy
): OpportunityScore {
  let baseScore = 0;
  let reason = strategyResult.reason;
  const state = marketState.state;
  
  // ========== 1. æ ¹æ®å¸‚åœºçŠ¶æ€ç»™åŸºç¡€åˆ† ==========
  
  // æœ€ä½³æ—¶æœºä½†ç­–ç•¥æœªè§¦å‘ï¼ˆæœ€å¯æƒœï¼‰
  if (state === "downtrend_overbought" || state === "uptrend_oversold") {
    if (strategy === "ultra-short" || strategy === "aggressive") {
      baseScore = 60;  // æ¿€è¿›ç­–ç•¥æ›´æ¿€è¿›,ç»™é«˜åˆ†æš—ç¤ºæ¥è¿‘
    } else {
      baseScore = 55;  // ç¨³å¥ç­–ç•¥è°¨æ…
    }
    reason = `æœ€ä½³å…¥åœºæ—¶æœºä½†æŒ‡æ ‡æœªå®Œå…¨æ»¡è¶³ã€‚${strategyResult.reason}`;
  }
  
  // è¶‹åŠ¿å»¶ç»­ï¼ˆæœ‰æœºä¼šä½†éœ€ç­‰å¾…ç²¾å‡†ç‚¹ä½ï¼‰
  else if (state === "downtrend_continuation" || state === "uptrend_continuation") {
    if (strategy === "swing-trend") {
      baseScore = 50;  // æ³¢æ®µç­–ç•¥å¯èƒ½åœ¨ç­‰å¾…å¤§çº§åˆ«ç¡®è®¤
      reason = `è¶‹åŠ¿å»¶ç»­ä¸­,ç­‰å¾…æ›´é«˜çº§åˆ«æ—¶é—´æ¡†æ¶ç¡®è®¤ã€‚${strategyResult.reason}`;
    } else if (strategy === "conservative") {
      baseScore = 48;  // ç¨³å¥ç­–ç•¥ç­‰å¾…æ›´å®‰å…¨ç‚¹ä½
      reason = `è¶‹åŠ¿æ˜ç¡®ä½†ç­‰å¾…æ›´å®‰å…¨çš„å…¥åœºç‚¹ã€‚${strategyResult.reason}`;
    } else {
      baseScore = 45;
      reason = `è¶‹åŠ¿æ˜ç¡®ä½†æš‚æ— ç²¾ç¡®å…¥åœºç‚¹ã€‚${strategyResult.reason}`;
    }
  }
  
  // éœ‡è¡å¸‚ï¼ˆè§‚æœ›ä¸ºä¸»ï¼‰
  else if (state.startsWith("ranging")) {
    if (strategy === "ultra-short") {
      baseScore = 35;  // è¶…çŸ­çº¿å¯èƒ½åœ¨éœ‡è¡ä¸­æ‰¾æœºä¼š
      reason = `éœ‡è¡å¸‚åœº,ç­‰å¾…è¾¹ç•Œçªç ´æˆ–åè½¬ä¿¡å·ã€‚${strategyResult.reason}`;
    } else {
      baseScore = 30;
      reason = `éœ‡è¡å¸‚åœº,ç­‰å¾…æ›´æ˜ç¡®ä¿¡å·ã€‚${strategyResult.reason}`;
    }
  }
  
  // å…¶ä»–çŠ¶æ€ï¼ˆçœŸæ­£çš„è§‚æœ›ï¼‰
  else {
    baseScore = 20;
    reason = `å¸‚åœºä¿¡å·ä¸æ˜ç¡®,æš‚æ—¶è§‚æœ›ã€‚${strategyResult.reason}`;
  }
  
  // ========== 2. è¶‹åŠ¿ä¸€è‡´æ€§åŠ æˆ ==========
  const alignmentScore = marketState.timeframeAlignment.alignmentScore;
  
  if (alignmentScore >= 0.8) {
    // å¤šæ—¶é—´æ¡†æ¶é«˜åº¦ä¸€è‡´,åªæ˜¯ç­–ç•¥æŒ‡æ ‡å·®ä¸€ç‚¹ç‚¹
    baseScore += 10;
    reason = `å¤šæ—¶é—´æ¡†æ¶é«˜åº¦ä¸€è‡´(${(alignmentScore * 100).toFixed(0)}%),${reason}`;
  } else if (alignmentScore >= 0.6) {
    baseScore += 5;
  }
  
  // ========== 3. æ³¢åŠ¨ç‡åŠ æˆ ==========
  const atrRatio = marketState.keyMetrics.atr_ratio;
  const volatilityPref = STRATEGY_VOLATILITY_PREFS[strategy];
  
  if (atrRatio >= volatilityPref.idealMin && atrRatio <= volatilityPref.idealMax) {
    // æ³¢åŠ¨ç‡å®Œç¾åŒ¹é…ç­–ç•¥
    baseScore += 5;
  }
  
  // ========== 4. æ„å»ºè¯„åˆ†å¯¹è±¡ ==========
  return {
    symbol: strategyResult.symbol,
    totalScore: Math.min(baseScore, 70),  // waitä¿¡å·æœ€é«˜70åˆ†,é¿å…æ··æ·†
    breakdown: {
      signalStrength: baseScore,
      trendConsistency: Math.round(alignmentScore * 25),
      volatilityFit: 0,
      riskRewardRatio: 0,
      liquidity: 0,
    },
    confidence: baseScore >= 55 ? "medium" : "low",
    recommendation: {
      strategyType: "none",
      direction: "wait",
      confidence: baseScore >= 55 ? "medium" : "low",
      reason,
    },
  };
}
```

**æ ¸å¿ƒæ”¹è¿›**:

âœ… waitä¿¡å·ä¸å†ä¸€åˆ€åˆ‡,æ ¹æ®"é”™è¿‡ç¨‹åº¦"ç»™åˆ†  
âœ… æ¿€è¿›ç­–ç•¥å¯¹waitä¿¡å·æ›´å®½å®¹,ç¨³å¥ç­–ç•¥æ›´è°¨æ…  
âœ… å¤šæ—¶é—´æ¡†æ¶ä¸€è‡´æ€§å’Œæ³¢åŠ¨ç‡åŒ¹é…å¯åŠ åˆ†  
âœ… waitä¿¡å·æœ€é«˜70åˆ†,ä¸ä¼šé«˜äºçœŸå®long/shortä¿¡å·

---

## ğŸ“ˆ ä¸‰ã€å®Œæ•´ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ

### 3.1 ä»£ç ç»“æ„é‡æ„

```typescript
// src/services/opportunityScorer.ts

import type { TradingStrategy } from "../agents/tradingAgent";

/**
 * ç­–ç•¥å·®å¼‚åŒ–æƒé‡é…ç½®
 */
const STRATEGY_SCORE_WEIGHTS: Record<TradingStrategy, StrategyScoreWeights> = {
  // ... (è§2.1èŠ‚)
};

/**
 * ç­–ç•¥æ³¢åŠ¨ç‡åå¥½é…ç½®
 */
const STRATEGY_VOLATILITY_PREFS: Record<TradingStrategy, VolatilityPreference> = {
  // ... (è§2.2èŠ‚)
};

/**
 * ä¸»è¯„åˆ†å‡½æ•°ï¼ˆç­–ç•¥æ„ŸçŸ¥ç‰ˆï¼‰
 */
export function scoreOpportunity(
  strategyResult: StrategyResult,
  marketState: MarketStateAnalysis,
  strategy: TradingStrategy  // æ–°å¢å‚æ•°
): OpportunityScore {
  // waitä¿¡å·ç‰¹æ®Šå¤„ç†
  if (strategyResult.action === "wait") {
    return calculateWaitScore(strategyResult, marketState, strategy);
  }
  
  // è·å–ç­–ç•¥æƒé‡é…ç½®
  const weights = STRATEGY_SCORE_WEIGHTS[strategy];
  
  // 1. ä¿¡å·å¼ºåº¦è¯„åˆ†
  const signalScore = strategyResult.signalStrength * weights.signalStrength;
  
  // 2. è¶‹åŠ¿ä¸€è‡´æ€§è¯„åˆ†
  const trendScore = marketState.timeframeAlignment.alignmentScore * weights.trendConsistency;
  
  // 3. æ³¢åŠ¨ç‡é€‚é…è¯„åˆ†ï¼ˆç­–ç•¥åŒ–ï¼‰
  const volatilityScore = calculateVolatilityFitScore(marketState, strategy) * weights.volatilityFit;
  
  // 4. é£é™©æ”¶ç›Šæ¯”è¯„åˆ†ï¼ˆç²¾ç»†åŒ–ï¼‰
  const rrScore = calculateRiskRewardScore(strategyResult, marketState, strategy) * weights.riskRewardRatio;
  
  // 5. æµåŠ¨æ€§è¯„åˆ†ï¼ˆåŠ¨æ€åŒ–ï¼‰
  const liquidityScore = calculateLiquidityScore(strategyResult.symbol, strategy) * weights.liquidity;
  
  // è®¡ç®—æ€»åˆ†
  const totalScore = signalScore + trendScore + volatilityScore + rrScore + liquidityScore;
  
  // æ ¹æ®æ€»åˆ†åˆ¤æ–­ç½®ä¿¡åº¦ï¼ˆä½¿ç”¨ç­–ç•¥é˜ˆå€¼ï¼‰
  let confidence: "high" | "medium" | "low";
  const highThreshold = weights.minScore;
  const mediumThreshold = highThreshold - 15;
  
  if (totalScore >= highThreshold) {
    confidence = "high";
  } else if (totalScore >= mediumThreshold) {
    confidence = "medium";
  } else {
    confidence = "low";
  }
  
  return {
    symbol: strategyResult.symbol,
    totalScore: Math.round(totalScore),
    breakdown: {
      signalStrength: Math.round(signalScore),
      trendConsistency: Math.round(trendScore),
      volatilityFit: Math.round(volatilityScore),
      riskRewardRatio: Math.round(rrScore),
      liquidity: Math.round(liquidityScore),
    },
    confidence,
    recommendation: {
      strategyType: strategyResult.strategyType as any,
      direction: strategyResult.action === "long" ? "long" : strategyResult.action === "short" ? "short" : "wait",
      confidence,
      reason: strategyResult.reason,
    },
  };
}

/**
 * æ‰¹é‡è¯„åˆ†å‡½æ•°ï¼ˆé€‚é…ç­–ç•¥ï¼‰
 */
export function scoreAndRankOpportunities(
  strategyResults: StrategyResult[],
  marketStates: Map<string, MarketStateAnalysis>,
  strategy: TradingStrategy,  // æ–°å¢å‚æ•°
  customMinScore?: number     // å¯é€‰çš„è‡ªå®šä¹‰é˜ˆå€¼
): OpportunityScore[] {
  const weights = STRATEGY_SCORE_WEIGHTS[strategy];
  const minScore = customMinScore ?? weights.minScore;
  
  logger.info(`ä½¿ç”¨ç­–ç•¥ ${strategy} è¯„åˆ† ${strategyResults.length} ä¸ªæœºä¼šï¼ˆé˜ˆå€¼: ${minScore}ï¼‰...`);
  
  const scores: OpportunityScore[] = [];
  
  for (const result of strategyResults) {
    const marketState = marketStates.get(result.symbol);
    if (!marketState) {
      logger.warn(`æœªæ‰¾åˆ° ${result.symbol} çš„å¸‚åœºçŠ¶æ€ï¼Œè·³è¿‡è¯„åˆ†`);
      continue;
    }
    
    const score = scoreOpportunity(result, marketState, strategy);
    
    // åªä¿ç•™è¯„åˆ†è¾¾æ ‡çš„æœºä¼š
    if (score.totalScore >= minScore) {
      scores.push(score);
    }
  }
  
  // æŒ‰æ€»åˆ†é™åºæ’åº
  scores.sort((a, b) => b.totalScore - a.totalScore);
  
  logger.info(`è¯„åˆ†å®Œæˆï¼Œ${scores.length} ä¸ªæœºä¼šè¾¾åˆ°æœ€ä½è¯„åˆ† ${minScore}`);
  
  return scores;
}
```

### 3.2 è°ƒç”¨ä¾§é€‚é…

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**: `src/agents/tradingAgent.ts`

```typescript
// åœ¨ analyzeMarketAndFindOpportunities() å‡½æ•°ä¸­

// è·å–å½“å‰ç­–ç•¥
const currentStrategy = getTradingStrategy();

// è°ƒç”¨è¯„åˆ†ç³»ç»Ÿæ—¶ä¼ å…¥ç­–ç•¥
const rankedOpportunities = scoreAndRankOpportunities(
  strategyResults,
  marketStates,
  currentStrategy,  // æ–°å¢: ä¼ å…¥å½“å‰ç­–ç•¥
  // customMinScore å¯é€‰å‚æ•°,ä¸ä¼ åˆ™ä½¿ç”¨ç­–ç•¥é»˜è®¤é˜ˆå€¼
);
```

### 3.3 é…ç½®å…¼å®¹æ€§

**ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§**:

```bash
# .env é…ç½®ç¤ºä¾‹

# ç­–ç•¥é€‰æ‹©ï¼ˆå·²æœ‰é…ç½®ï¼‰
TRADING_STRATEGY=balanced  # ultra-short | aggressive | balanced | conservative | swing-trend

# è¯„åˆ†é˜ˆå€¼ï¼ˆå¯é€‰è¦†ç›–ï¼‰
MIN_OPPORTUNITY_SCORE=75   # ä¼šè¢«ç­–ç•¥é»˜è®¤å€¼è¦†ç›–,é™¤éæ˜¾å¼è®¾ç½®
```

**é€»è¾‘**:

1. å¦‚æœ `process.env.MIN_OPPORTUNITY_SCORE` æœªè®¾ç½® â†’ ä½¿ç”¨ç­–ç•¥é»˜è®¤é˜ˆå€¼
2. å¦‚æœè®¾ç½®äº† â†’ è¦†ç›–ç­–ç•¥é»˜è®¤å€¼ï¼ˆç”¨äºè°ƒè¯•/ç‰¹æ®Šåœºæ™¯ï¼‰

---

## ğŸ§ª å››ã€æµ‹è¯•ä¸éªŒè¯æ–¹æ¡ˆ

### 4.1 å•å…ƒæµ‹è¯•

åˆ›å»º `scripts/test-opportunity-scorer.ts`:

```typescript
/**
 * æœºä¼šè¯„åˆ†ç³»ç»Ÿæµ‹è¯•è„šæœ¬
 */
import { scoreOpportunity } from "../src/services/opportunityScorer";
import type { TradingStrategy } from "../src/agents/tradingAgent";

// æ¨¡æ‹Ÿæ•°æ®
const mockStrategy: StrategyResult = {
  symbol: "BTC",
  action: "long",
  signalStrength: 0.8,
  recommendedLeverage: 3,
  strategyType: "momentum",
  reason: "ä¸Šæ¶¨è¶‹åŠ¿+è¶…å–å›è°ƒ",
};

const mockMarketState: MarketStateAnalysis = {
  state: "uptrend_oversold",
  keyMetrics: { atr_ratio: 1.1, /* ... */ },
  timeframeAlignment: { alignmentScore: 0.85, /* ... */ },
  // ...
};

// æµ‹è¯•ä¸åŒç­–ç•¥çš„è¯„åˆ†å·®å¼‚
const strategies: TradingStrategy[] = ["ultra-short", "aggressive", "balanced", "conservative", "swing-trend"];

for (const strategy of strategies) {
  const score = scoreOpportunity(mockStrategy, mockMarketState, strategy);
  console.log(`\nç­–ç•¥: ${strategy}`);
  console.log(`æ€»åˆ†: ${score.totalScore}`);
  console.log(`ç½®ä¿¡åº¦: ${score.confidence}`);
  console.log(`æ˜ç»†: ${JSON.stringify(score.breakdown, null, 2)}`);
}
```

**é¢„æœŸç»“æœ**:

- ultra-short: æ€»åˆ†è¾ƒé«˜ï¼ˆä¿¡å·å¼ºåº¦æƒé‡å¤§ï¼‰
- conservative: æ€»åˆ†å¯èƒ½è¾ƒä½ï¼ˆé£é™©æ”¶ç›Šæ¯”æƒé‡å¤§,è¦æ±‚ä¸¥æ ¼ï¼‰
- swing-trend: è¶‹åŠ¿ä¸€è‡´æ€§å¾—åˆ†é«˜

### 4.2 å›æµ‹éªŒè¯

**ç›®æ ‡**: å¯¹æ¯”ä¼˜åŒ–å‰åçš„å¼€ä»“é¢‘ç‡å’Œèƒœç‡

```bash
# è®°å½•ä¼˜åŒ–å‰çš„è¡¨ç°
TRADING_STRATEGY=balanced MIN_OPPORTUNITY_SCORE=75 npm run test:integration

# ä¼˜åŒ–åæµ‹è¯•
TRADING_STRATEGY=ultra-short  # åº”æ›´æ¿€è¿›
TRADING_STRATEGY=conservative # åº”æ›´è°¨æ…
```

**å…³é”®æŒ‡æ ‡**:

- å¼€ä»“æœºä¼šæ•°é‡ï¼ˆultra-short â†‘, conservative â†“ï¼‰
- å¹³å‡è¯„åˆ†åˆ†å¸ƒ
- å‡ä¿¡å·è¿‡æ»¤ç‡

### 4.3 å®ç›˜ç°åº¦

**å»ºè®®æ­¥éª¤**:

1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ç­–ç•¥å·®å¼‚åŒ–ç”Ÿæ•ˆ
2. å°ä»“ä½å®ç›˜æµ‹è¯•1-2å¤©
3. å¯¹æ¯”ä¸åŒç­–ç•¥çš„è¡¨ç°å·®å¼‚
4. æ ¹æ®å®ç›˜æ•°æ®å¾®è°ƒæƒé‡å‚æ•°

---

## ğŸ“‹ äº”ã€ä¼˜åŒ–ä¼˜å…ˆçº§ä¸å®æ–½å»ºè®®

### 5.1 ä¼˜å…ˆçº§æ’åº

| ä¼˜å…ˆçº§ | ä¼˜åŒ–é¡¹ | é‡è¦æ€§ | å®æ–½éš¾åº¦ | é¢„æœŸæ”¶ç›Š | å»ºè®® |
|--------|--------|--------|---------|---------|------|
| â­â­â­ | **ç­–ç•¥å·®å¼‚åŒ–æƒé‡** | é«˜ | ä¸­ | é«˜ | ç«‹å³å®æ–½ |
| â­â­â­ | **waitä¿¡å·æ™ºèƒ½è¯„åˆ†** | é«˜ | ä¸­ | é«˜ | ç«‹å³å®æ–½ |
| â­â­ | **æ³¢åŠ¨ç‡é€‚é…ç­–ç•¥åŒ–** | ä¸­ | ä½ | ä¸­ | ç¬¬äºŒé˜¶æ®µ |
| â­â­ | **æµåŠ¨æ€§è¯„åˆ†åŠ¨æ€åŒ–** | ä¸­ | ä¸­ | ä¸­ | ç¬¬äºŒé˜¶æ®µ |
| â­ | **é£é™©æ”¶ç›Šæ¯”ç²¾ç»†åŒ–** | ä¸­ | é«˜ | ä¸­ | ç¬¬ä¸‰é˜¶æ®µ |

### 5.2 åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

#### é˜¶æ®µä¸€: æ ¸å¿ƒä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰

1. âœ… å®æ–½ç­–ç•¥å·®å¼‚åŒ–æƒé‡é…ç½®
2. âœ… ä¼˜åŒ–waitä¿¡å·è¯„åˆ†é€»è¾‘
3. âœ… ä¿®æ”¹scoreOpportunityå‡½æ•°ç­¾å,å¢åŠ strategyå‚æ•°
4. âœ… é€‚é…tradingAgentè°ƒç”¨ä¾§
5. âœ… ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯

**é‡Œç¨‹ç¢‘**: ä¸åŒç­–ç•¥çš„è¯„åˆ†é˜ˆå€¼å’Œæƒé‡ç”Ÿæ•ˆ

#### é˜¶æ®µäºŒ: ç»†èŠ‚ä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰

1. âœ… å®æ–½æ³¢åŠ¨ç‡é€‚é…ç­–ç•¥åŒ–
2. âœ… å®æ–½æµåŠ¨æ€§è¯„åˆ†åŠ¨æ€åŒ–
3. âœ… å®Œå–„æ—¥å¿—è¾“å‡º,å¢åŠ è¯„åˆ†æ˜ç»†
4. âœ… ç¼–å†™é›†æˆæµ‹è¯•

**é‡Œç¨‹ç¢‘**: å„è¯„åˆ†ç»´åº¦æ›´åŠ ç²¾ç»†,é€‚é…ç­–ç•¥ç‰¹æ€§

#### é˜¶æ®µä¸‰: æ·±åº¦é›†æˆï¼ˆ3-5å¤©ï¼‰

1. â³ é›†æˆç§‘å­¦æ­¢æŸç³»ç»Ÿè®¡ç®—å®é™…R:R
2. â³ é›†æˆåˆ†æ‰¹æ­¢ç›ˆç³»ç»Ÿè®¡ç®—æœŸæœ›æ”¶ç›Š
3. â³ é›†æˆäº¤æ˜“æ‰€APIè·å–å®æ—¶æˆäº¤é‡/æ·±åº¦
4. â³ å›æµ‹éªŒè¯ä¼˜åŒ–æ•ˆæœ

**é‡Œç¨‹ç¢‘**: è¯„åˆ†ç³»ç»Ÿå…¨é¢å¯¹æ¥ç³»ç»Ÿå…¶ä»–æ¨¡å—

### 5.3 å‘åå…¼å®¹æ€§

**è®¾è®¡åŸåˆ™**: ç¡®ä¿ä¼˜åŒ–ä¸ç ´åç°æœ‰åŠŸèƒ½

```typescript
// å…¼å®¹æ€§å¤„ç†ç¤ºä¾‹

export function scoreOpportunity(
  strategyResult: StrategyResult,
  marketState: MarketStateAnalysis,
  strategy?: TradingStrategy  // å¯é€‰å‚æ•°,é»˜è®¤balanced
): OpportunityScore {
  const currentStrategy = strategy ?? "balanced";
  // ... ä½¿ç”¨ currentStrategy
}
```

**å¥½å¤„**:

- å¦‚æœè°ƒç”¨ä¾§æœªä¼ å…¥strategy,ä½¿ç”¨é»˜è®¤balancedç­–ç•¥
- ç°æœ‰ä»£ç æ— éœ€ç«‹å³ä¿®æ”¹,æ¸è¿›å¼å‡çº§
- é™ä½å›å½’é£é™©

---

## ğŸ’¡ å…­ã€å‚æ•°è°ƒä¼˜å»ºè®®

### 6.1 æƒé‡å‚æ•°è°ƒä¼˜

**å½“å‰é…ç½®ä¸ºç†è®ºæœ€ä¼˜å€¼,å»ºè®®æ ¹æ®å®ç›˜æ•°æ®å¾®è°ƒ**:

```typescript
// è°ƒä¼˜æ–¹å‘æŒ‡å—

1. å¦‚æœ ultra-short ç­–ç•¥å¼€ä»“è¿‡å°‘:
   - é™ä½ minScore: 65 â†’ 60
   - å¢åŠ  signalStrength æƒé‡: 35 â†’ 38
   - é™ä½ trendConsistency æƒé‡: 20 â†’ 17

2. å¦‚æœ conservative ç­–ç•¥å‡ä¿¡å·å¤š:
   - æé«˜ minScore: 80 â†’ 85
   - å¢åŠ  riskRewardRatio æƒé‡: 20 â†’ 23
   - å¢åŠ  trendConsistency æƒé‡: 30 â†’ 32

3. å¦‚æœ swing-trend ç­–ç•¥é”™è¿‡å¤§è¡Œæƒ…:
   - é™ä½ minScore: 78 â†’ 73
   - waitä¿¡å·åŸºç¡€åˆ†æé«˜: 50 â†’ 55
```

### 6.2 æ³¢åŠ¨ç‡å‚æ•°è°ƒä¼˜

```typescript
// è°ƒä¼˜æ–¹å‘æŒ‡å—

1. å¦‚æœ ultra-short åœ¨å¹³é™å¸‚åœºå¼€ä»“è¿‡å°‘:
   - é™ä½ idealMin: 1.0 â†’ 0.9
   - æ‰©å¤§å¯æ¥å—èŒƒå›´: acceptableMin 0.8 â†’ 0.7

2. å¦‚æœ conservative åœ¨å‰§çƒˆæ³¢åŠ¨æ—¶ä»å¼€ä»“:
   - é™ä½ idealMax: 1.0 â†’ 0.9
   - å¢åŠ  penaltyFactor: 0.7 â†’ 0.8
```

### 6.3 ç›‘æ§æŒ‡æ ‡

**å»ºè®®è®°å½•ä»¥ä¸‹æŒ‡æ ‡,ç”¨äºå‚æ•°è°ƒä¼˜**:

```typescript
// åœ¨æ—¥å¿—ä¸­è®°å½•

{
  "strategy": "ultra-short",
  "opportunities_total": 15,
  "opportunities_passed": 5,
  "pass_rate": 0.33,
  "avg_score": 68.5,
  "avg_score_passed": 78.2,
  "breakdown_avg": {
    "signalStrength": 26.5,
    "trendConsistency": 18.3,
    // ...
  }
}
```

**è°ƒä¼˜ä¾æ®**:

- å¦‚æœ `pass_rate` è¿‡ä½ â†’ é˜ˆå€¼å¤ªé«˜æˆ–æƒé‡ä¸åˆç†
- å¦‚æœ `avg_score_passed` æ¥è¿‘é˜ˆå€¼ â†’ é˜ˆå€¼å¯èƒ½åé«˜
- å¦‚æœæŸä¸€ç»´åº¦å¾—åˆ†æ™®éåä½ â†’ å¯èƒ½éœ€è¦è°ƒæ•´è¯¥ç»´åº¦çš„è®¡ç®—é€»è¾‘

---

## ğŸ“Š ä¸ƒã€ä¼˜åŒ–é¢„æœŸæ•ˆæœ

### 7.1 å®šé‡é¢„æœŸ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| ultra-short å¼€ä»“æœºä¼š | åŸºå‡† | +30%-50% | â­â­â­ |
| conservative å‡ä¿¡å·ç‡ | åŸºå‡† | -20%-30% | â­â­â­ |
| swing-trend å¤§è¡Œæƒ…æ•è· | åŸºå‡† | +15%-25% | â­â­ |
| waitä¿¡å·ä¿¡æ¯é‡ | ä½ | ä¸­ç­‰ | â­â­ |
| è¯„åˆ†ç³»ç»Ÿç²¾å‡†åº¦ | ä¸­ | é«˜ | â­â­â­ |

### 7.2 å®šæ€§é¢„æœŸ

âœ… **ç­–ç•¥ç‰¹æ€§å……åˆ†å‘æŒ¥**: æ¿€è¿›ç­–ç•¥æ›´æ¿€è¿›,ç¨³å¥ç­–ç•¥æ›´ç¨³å¥  
âœ… **è¯„åˆ†æ›´åŠ åˆç†**: ä¸å†"ä¸€åˆ€åˆ‡",è€ƒè™‘ç­–ç•¥å·®å¼‚  
âœ… **waitä¿¡å·æœ‰ä»·å€¼**: æç¤º"å·®ä¸€ç‚¹ç‚¹"vs"å®Œå…¨ä¸åˆé€‚"  
âœ… **ç³»ç»ŸååŒæ€§æå‡**: ä¸æ—¶é—´æ¡†æ¶ä¼˜åŒ–ã€ç§‘å­¦æ­¢æŸç³»ç»ŸååŒ  
âœ… **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**: ç­–ç•¥é€‰æ‹©ä¸å®é™…è¡¨ç°æ›´ä¸€è‡´

---

## ğŸš€ å…«ã€æ€»ç»“ä¸å»ºè®®

### 8.1 å½“å‰è¯„åˆ†ç³»ç»Ÿè¯„ä¼°æ€»ç»“

**ä¼˜ç‚¹**:

- âœ… å¤šç»´åº¦è¯„ä¼°æ¡†æ¶åˆç†
- âœ… å¸‚åœºçŠ¶æ€æ„ŸçŸ¥æœºåˆ¶æœ‰æ•ˆ
- âœ… åŸºç¡€é€»è¾‘æ¸…æ™°å¯ç»´æŠ¤

**ä¸è¶³**:

- âš ï¸ æœªè€ƒè™‘ç­–ç•¥å·®å¼‚,æ‰€æœ‰ç­–ç•¥ä¸€è§†åŒä»
- âš ï¸ waitä¿¡å·è¯„åˆ†è¿‡ä½,é”™è¿‡æ½œåœ¨æœºä¼š
- âš ï¸ æ³¢åŠ¨ç‡/æµåŠ¨æ€§è¯„åˆ†ç²—ç³™
- âš ï¸ é£é™©æ”¶ç›Šæ¯”æœªä¸ç§‘å­¦æ­¢æŸé›†æˆ

### 8.2 æ ¸å¿ƒä¼˜åŒ–å»ºè®®

**ç«‹å³å®æ–½**ï¼ˆæ¨èæŒ‡æ•°: â­â­â­â­â­ï¼‰:

1. **ç­–ç•¥å·®å¼‚åŒ–æƒé‡é…ç½®** - ä¸åŒç­–ç•¥ä½¿ç”¨ä¸åŒè¯„åˆ†æƒé‡å’Œé˜ˆå€¼
2. **waitä¿¡å·æ™ºèƒ½è¯„åˆ†** - æ ¹æ®å¸‚åœºçŠ¶æ€å’Œç­–ç•¥ç‰¹æ€§åŠ¨æ€è¯„åˆ†

**ç¬¬äºŒé˜¶æ®µ**ï¼ˆæ¨èæŒ‡æ•°: â­â­â­â­ï¼‰:

1. **æ³¢åŠ¨ç‡é€‚é…ç­–ç•¥åŒ–** - ä¸åŒç­–ç•¥åå¥½ä¸åŒæ³¢åŠ¨ç‡
2. **æµåŠ¨æ€§è¯„åˆ†åŠ¨æ€åŒ–** - ç»“åˆå®æ—¶æˆäº¤é‡

**ç¬¬ä¸‰é˜¶æ®µ**ï¼ˆæ¨èæŒ‡æ•°: â­â­â­ï¼‰:

1. **é£é™©æ”¶ç›Šæ¯”ç²¾ç»†åŒ–** - é›†æˆç§‘å­¦æ­¢æŸ,è®¡ç®—å®é™…R:R

### 8.3 ä¸å¸‚åœºçŠ¶æ€ç³»ç»Ÿçš„ååŒ

**å·²å®Œæˆçš„æ—¶é—´æ¡†æ¶ä¼˜åŒ–ä¸è¯„åˆ†ç³»ç»Ÿçš„é…åˆ**:

```text
ç­–ç•¥è‡ªé€‚åº”æ—¶é—´æ¡†æ¶ â”€â”€â”
                    â”œâ”€â”€> å¤šæ—¶é—´æ¡†æ¶åˆ†æ â”€â”€> å¸‚åœºçŠ¶æ€åˆ¤æ–­ â”€â”€> ç­–ç•¥å»ºè®®
                    â”‚                                        â”‚
ç­–ç•¥å·®å¼‚åŒ–è¯„åˆ†ç³»ç»Ÿ â”€â”€â”˜                                        â””â”€â”€> æœ€ç»ˆè¯„åˆ†æ’åº
```

**ååŒæ•ˆåº”**:

1. âœ… ultra-short ä½¿ç”¨ 3min+5min+15min æ—¶é—´æ¡†æ¶ â†’ å¿«é€Ÿå“åº”
   â†’ è¯„åˆ†ç³»ç»Ÿé™ä½é˜ˆå€¼(65åˆ†) â†’ æ›´å¤šå¼€ä»“æœºä¼š

2. âœ… swing-trend ä½¿ç”¨ 15min+1h+4h æ—¶é—´æ¡†æ¶ â†’ ç¨³å¥åˆ¤æ–­
   â†’ è¯„åˆ†ç³»ç»Ÿçœ‹é‡è¶‹åŠ¿ä¸€è‡´æ€§(35%) â†’ è¿‡æ»¤å‡çªç ´

3. âœ… conservative ä½¿ç”¨ 15min+30min+1h æ—¶é—´æ¡†æ¶ â†’ åŒé‡éªŒè¯
   â†’ è¯„åˆ†ç³»ç»Ÿä¸¥æ ¼R:Rè¦æ±‚(20%) â†’ é™ä½é£é™©

### 8.4 å®æ–½å»ºè®®

**ä¸ºç”¨æˆ·æä¾›çš„å»ºè®®**:

1. **ä¼˜å…ˆå®æ–½æ ¸å¿ƒä¼˜åŒ–** (ç­–ç•¥å·®å¼‚åŒ–æƒé‡ + waitä¿¡å·ä¼˜åŒ–)
   - ä»£ç æ”¹åŠ¨é‡ä¸­ç­‰
   - æ•ˆæœç«‹ç«¿è§å½±
   - é£é™©å¯æ§

2. **å……åˆ†æµ‹è¯•åä¸Šçº¿**
   - å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å„ç­–ç•¥è¯„åˆ†å·®å¼‚
   - å°ä»“ä½å®ç›˜ç°åº¦1-2å¤©
   - æ ¹æ®å®ç›˜æ•°æ®å¾®è°ƒå‚æ•°

3. **é€æ­¥æ¨è¿›æ·±åº¦ä¼˜åŒ–**
   - æ³¢åŠ¨ç‡/æµåŠ¨æ€§ä¼˜åŒ–å¯ä»¥ç¬¬äºŒé˜¶æ®µå®æ–½
   - é£é™©æ”¶ç›Šæ¯”ç²¾ç»†åŒ–éœ€è¦ç­‰å¾…ç§‘å­¦æ­¢æŸç³»ç»Ÿç¨³å®šåé›†æˆ

4. **ä¿æŒå‘åå…¼å®¹**
   - strategyå‚æ•°è®¾ä¸ºå¯é€‰,é»˜è®¤balanced
   - ç°æœ‰ä»£ç æ— éœ€ç«‹å³ä¿®æ”¹
   - æ¸è¿›å¼å‡çº§é™ä½é£é™©

---

## ğŸ“ é™„å½•

### A. å®Œæ•´é…ç½®å‚è€ƒ

è¯¦è§ä»£ç ç¤ºä¾‹ç« èŠ‚ 2.1 - 2.5

### B. æµ‹è¯•è„šæœ¬å‚è€ƒ

è¯¦è§ç« èŠ‚ 4.1 å•å…ƒæµ‹è¯•

### C. ç›‘æ§æŒ‡æ ‡æ¨¡æ¿

è¯¦è§ç« èŠ‚ 6.3 ç›‘æ§æŒ‡æ ‡

### D. ç›¸å…³æ–‡æ¡£

- ã€Šå¸‚åœºçŠ¶æ€åˆ¤æ–­ç³»ç»Ÿ-ä¼˜åŒ–åˆ†æä¸æ–¹æ¡ˆ.mdã€‹- æ—¶é—´æ¡†æ¶ä¼˜åŒ–
- ã€Šå¸‚åœºçŠ¶æ€åˆ¤æ–­ç³»ç»Ÿ-å®æ–½è¿›åº¦.mdã€‹- å®æ–½è®°å½•
- ã€Šå¼€ä»“æœºä¼šè¯„åˆ†ç³»ç»Ÿ-ä¼˜åŒ–å»ºè®®.mdã€‹- å†å²ä¼˜åŒ–å»ºè®®
- ã€Šç§‘å­¦æ­¢æŸç³»ç»Ÿ - å¿«é€Ÿå…¥é—¨ç¤ºä¾‹.mdã€‹- æ­¢æŸç³»ç»Ÿå‚è€ƒ

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£åº”éšç€å®æ–½è¿›åº¦å’Œå®ç›˜åé¦ˆæŒç»­æ›´æ–°,å»ºè®®åœ¨æ¯æ¬¡å‚æ•°è°ƒä¼˜åè®°å½•è°ƒæ•´åŸå› å’Œæ•ˆæœã€‚
